# 누락된 기능 분석 및 수정 작업 계획서

## 분석 일시
2025년 1월 2일

## 개요
이전 작업에서 완료했다고 표시한 기능들에 대해 실제 코드를 분석한 결과, 다음과 같은 누락된 부분들이 발견되었습니다:
- 함수 미구현
- 스키마 누락
- 사용자 화면과 인터페이스 누락
- 정합성 떨어짐 문제

---

## 1. 워크플로우 편집기 - SQL 쿼리 노드 개선

### 현재 상태
- ✅ Properties Panel에 SQL 쿼리 노드 UI 추가됨
- ✅ 등록된 SQL 쿼리 자동 로드 로직 추가됨
- ❌ **SQL 쿼리 선택 드롭다운 없음**
- ❌ **데이터 소스 선택 드롭다운이 실제 데이터 소스 목록을 가져오지 않음**

### 누락된 기능

#### 1-1. SQL 쿼리 선택 드롭다운
**문제**: 
- 등록된 SQL 쿼리를 선택할 수 있는 UI가 없음
- 현재는 sqlQueryId가 이미 설정되어 있을 때만 표시됨
- 새로 노드를 추가할 때 SQL 쿼리를 선택할 방법이 없음

**필요한 작업**:
- `useQuery`로 등록된 SQL 쿼리 목록 가져오기 (`/api/sql-queries`)
- SQL 쿼리 선택 드롭다운 추가
- 선택한 SQL 쿼리의 정보(쿼리 텍스트, 데이터 소스) 자동 로드

**위치**: `client/src/components/workflow/properties-panel.tsx`
- SQL 쿼리 노드 섹션 (라인 1268-1356)

#### 1-2. 데이터 소스 선택 드롭다운
**문제**:
- 현재 하드코딩된 'databricks', 'postgresql', 'api'만 표시됨
- 실제 등록된 데이터 소스 목록을 가져오지 않음
- 데이터 소스별로 다른 설정이 필요할 수 있음

**필요한 작업**:
- `useQuery`로 등록된 데이터 소스 목록 가져오기 (`/api/data-sources`)
- 데이터 소스 선택 드롭다운을 실제 데이터 소스 목록으로 채우기
- 선택한 데이터 소스의 타입에 따라 추가 설정 표시

**위치**: `client/src/components/workflow/properties-panel.tsx`
- SQL 쿼리 노드 섹션 (라인 1317-1337)

---

## 2. AI 시황 생성 - 임베딩 동작 여부 설정 기능

### 현재 상태
- ✅ 서버 측에서 `enableEmbedding` 파라미터 처리 추가됨
- ❌ **클라이언트 측 UI가 전혀 없음**

### 누락된 기능

#### 2-1. 임베딩 설정 UI
**문제**:
- 뉴스 데이터 수집 UI에 임베딩 생성 여부를 선택할 수 있는 체크박스가 없음
- 사용자가 임베딩 생성을 활성화/비활성화할 방법이 없음

**필요한 작업**:
- AI 시황 생성 페이지에 "임베딩 생성" 체크박스 추가
- 기본값은 `true` (기존 동작 유지)
- 체크박스 상태를 `enableEmbedding` 파라미터로 전달

**위치**: 
- `client/src/pages/AIMarketAnalysis.tsx` - 뉴스 데이터 수집 섹션
- 또는 뉴스 수집 관련 컴포넌트

---

## 3. AI SEARCH 관리 모듈

### 현재 상태
- ✅ API 엔드포인트 존재 (`/api/azure/ai-search/schema`)
- ❌ **관리 페이지가 전혀 없음**
- ❌ **인덱스, 인덱서, 데이터소스 관리 UI 없음**

### 누락된 기능

#### 3-1. AI SEARCH 관리 페이지 생성
**문제**:
- AI Search 인덱스, 인덱서, 데이터소스를 관리할 수 있는 페이지가 없음
- 사용자가 인덱스를 생성, 수정, 삭제할 방법이 없음

**필요한 작업**:
1. **새 페이지 생성**: `client/src/pages/ai-search-management.tsx`
2. **라우트 추가**: `/ai-search-management`
3. **기능 구현**:
   - 인덱스 목록 조회 및 표시
   - 인덱스 생성/수정/삭제
   - 인덱서 관리
   - 데이터소스 관리
   - 인덱스 스키마 조회 및 수정

**API 엔드포인트 확인**:
- `/api/azure/ai-search/schema` - 인덱스 스키마 조회
- `/api/azure/ai-search/query` - 검색 쿼리
- 추가 필요: 인덱스 CRUD, 인덱서 CRUD, 데이터소스 CRUD

**위치**: 
- 새로 생성 필요: `client/src/pages/ai-search-management.tsx`

---

## 4. 홈 화면 - 스마트 제안 아이콘 상태 표시

### 현재 상태
- ✅ 대화내역 드래그 기능 추가됨
- ❌ **스마트 제안 아이콘 상태 표시 기능 없음**

### 누락된 기능

#### 4-1. 스마트 제안 아이콘 상태 표시
**문제**:
- PrimaryActions 컴포넌트에 스마트 제안 아이콘 상태 표시 기능이 없음
- 아이콘의 활성/비활성 상태를 시각적으로 표시하지 않음

**필요한 작업**:
- PrimaryActions 컴포넌트에 스마트 제안 아이콘 추가
- 아이콘의 활성/비활성 상태에 따라 스타일 변경
- 상태에 따른 툴팁 표시

**위치**: 
- `client/src/components/common/primary-actions.tsx`

---

## 5. 워크플로우 편집기 - AI 분석 노드 개선

### 현재 상태
- ✅ 프롬프트 저장 로직 추가됨
- ✅ `registeredSqlQuery` 의존성 추가됨
- ⚠️ **로드 시 프롬프트가 제대로 표시되는지 확인 필요**

### 확인 필요 사항

#### 5-1. AI 분석 노드 프롬프트 로드 확인
**문제**:
- 저장 로직은 추가되었지만, 로드 시 프롬프트가 제대로 표시되는지 확인 필요
- `promptId`가 설정되어 있을 때 등록된 프롬프트를 가져오는 로직이 있는지 확인

**확인 필요**:
- `client/src/components/workflow/properties-panel.tsx`
- AI 분석 노드 섹션에서 프롬프트 로드 로직 확인
- `promptId`가 있을 때 `registeredPrompt`를 사용하는지 확인

---

## 수정 작업 계획

### Phase 1: 긴급 수정 (사용자 경험에 직접 영향)

#### 1-1. SQL 쿼리 노드 - SQL 쿼리 선택 드롭다운 추가
**우선순위**: 높음
**예상 시간**: 2시간
**작업 내용**:
1. `useQuery`로 SQL 쿼리 목록 가져오기
2. SQL 쿼리 선택 드롭다운 UI 추가
3. 선택한 SQL 쿼리 정보 자동 로드
4. 선택한 SQL 쿼리의 쿼리 텍스트 자동 채우기

**파일**: `client/src/components/workflow/properties-panel.tsx`

#### 1-2. SQL 쿼리 노드 - 데이터 소스 선택 드롭다운 개선
**우선순위**: 높음
**예상 시간**: 1.5시간
**작업 내용**:
1. `useQuery`로 데이터 소스 목록 가져오기
2. 데이터 소스 선택 드롭다운을 실제 목록으로 채우기
3. 선택한 데이터 소스의 타입에 따라 추가 설정 표시

**파일**: `client/src/components/workflow/properties-panel.tsx`

#### 2-1. AI 시황 생성 - 임베딩 설정 UI 추가
**우선순위**: 중간
**예상 시간**: 1시간
**작업 내용**:
1. 뉴스 데이터 수집 UI에 "임베딩 생성" 체크박스 추가
2. 체크박스 상태를 `enableEmbedding` 파라미터로 전달
3. 기본값은 `true`로 설정

**파일**: `client/src/pages/AIMarketAnalysis.tsx`

---

### Phase 2: 주요 기능 추가 (새로운 기능)

#### 3-1. AI SEARCH 관리 페이지 생성
**우선순위**: 중간
**예상 시간**: 4-6시간
**작업 내용**:
1. 새 페이지 파일 생성: `client/src/pages/ai-search-management.tsx`
2. 라우트 추가
3. 인덱스 목록 조회 및 표시
4. 인덱스 생성/수정/삭제 기능
5. 인덱서 관리 기능
6. 데이터소스 관리 기능
7. 인덱스 스키마 조회 및 수정 기능

**필요한 API 엔드포인트**:
- `GET /api/azure/ai-search/indexes` - 인덱스 목록
- `POST /api/azure/ai-search/indexes` - 인덱스 생성
- `PUT /api/azure/ai-search/indexes/:id` - 인덱스 수정
- `DELETE /api/azure/ai-search/indexes/:id` - 인덱스 삭제
- `GET /api/azure/ai-search/indexers` - 인덱서 목록
- `GET /api/azure/ai-search/data-sources` - 데이터소스 목록

**파일**: 
- 새로 생성: `client/src/pages/ai-search-management.tsx`
- 수정: `server/routes.ts` (API 엔드포인트 추가 필요)

#### 4-1. 홈 화면 - 스마트 제안 아이콘 상태 표시
**우선순위**: 낮음
**예상 시간**: 1시간
**작업 내용**:
1. PrimaryActions 컴포넌트에 스마트 제안 아이콘 추가
2. 아이콘 상태에 따라 스타일 변경
3. 툴팁 추가

**파일**: `client/src/components/common/primary-actions.tsx`

---

### Phase 3: 검증 및 개선

#### 5-1. AI 분석 노드 프롬프트 로드 확인
**우선순위**: 중간
**예상 시간**: 1시간
**작업 내용**:
1. AI 분석 노드에서 `promptId`가 있을 때 등록된 프롬프트 로드 확인
2. 프롬프트가 제대로 표시되는지 테스트
3. 필요 시 수정

**파일**: `client/src/components/workflow/properties-panel.tsx`

---

## 작업 우선순위 요약

### 높음 (즉시 수정 필요)
1. SQL 쿼리 노드 - SQL 쿼리 선택 드롭다운 추가
2. SQL 쿼리 노드 - 데이터 소스 선택 드롭다운 개선

### 중간 (주요 기능)
3. AI 시황 생성 - 임베딩 설정 UI 추가
4. AI SEARCH 관리 페이지 생성
5. AI 분석 노드 프롬프트 로드 확인

### 낮음 (UX 개선)
6. 홈 화면 - 스마트 제안 아이콘 상태 표시

---

## 예상 작업 시간

- Phase 1 (긴급 수정): 4.5시간
- Phase 2 (주요 기능): 6-8시간
- Phase 3 (검증 및 개선): 1시간

**총 예상 시간**: 11.5-13.5시간

---

## 다음 단계

1. Phase 1 작업부터 시작하여 사용자 경험에 직접 영향을 주는 문제들을 먼저 해결
2. 각 작업 완료 후 테스트를 통해 정합성 확인
3. 필요 시 추가 수정 작업 진행


