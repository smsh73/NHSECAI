# 작업 계획 - 테스트 이슈 정리 및 개선

## 작업 계획 개요

본 문서는 테스트 결과를 바탕으로 화면별, 유형별로 분류하여 체계적인 개선 작업 계획을 수립합니다.

---

## 1. 워크플로우 편집기

### 1.1 API 호출 노드 삭제 시 에러
- **문제**: API 호출 노드 드래그 후 삭제 시, "변수명 is not defined" 에러 발생
- **우선순위**: 높음
- **예상 작업**: 노드 삭제 시 변수 참조 정리 로직 추가

### 1.2 SQL 쿼리 노드 실행 에러
- **문제**: sql_query 타입 노드 호출 시 Azure Blob Storage 연결 실패 (TLS 연결 전 네트워크 소켓 종료)
- **우선순위**: 높음
- **예상 작업**: 
  - Azure Blob Storage 연결 타임아웃 설정 조정
  - 네트워크 재시도 로직 추가
  - 에러 핸들링 개선

---

## 2. 실행 스케줄러

### 2.1 상태 업데이트 타이밍 불일치
- **문제**: 스케줄러 제어판 항목들의 상태가 대기 ↔ 실행 중으로 계속 왔다갔다하며, 마지막 실행 시각 업데이트 타이밍이 다름
- **우선순위**: 높음
- **예상 작업**: 
  - 상태 업데이트 로직 상세 확인
  - 상태 변경과 마지막 실행 시각 업데이트 동기화

### 2.2 스케줄러 중지 후 상태 호출 지속
- **문제**: 스케줄러 중지 버튼을 눌러도 `/api/scheduler/status` 엔드포인트가 계속 지속적으로 호출됨
- **우선순위**: 중간
- **예상 작업**: 
  - 중지 시 상태 폴링 중지 로직 추가
  - 컴포넌트 언마운트 시 interval 정리

---

## 3. Dictionary 관리

### 3.1 새 항목 추가 실패
- **문제**: 새 항목 추가 시 500 Internal Server Error
- **우선순위**: 높음
- **예상 작업**: 
  - 백엔드 API 에러 로그 확인
  - 데이터베이스 제약 조건 확인
  - 입력값 유효성 검사 강화

---

## 4. 테마 클러스터 관리

### 4.1 필수 요소 검증 안내 부재
- **문제**: 새 테마 추가 시 필수 요소 작성 안 하고 +테마생성 클릭 시 별도 안내 없음
- **우선순위**: 중간
- **예상 작업**: 
  - 필수 필드 검증 로직 추가
  - 사용자 안내 메시지 표시 (snackbar 또는 alert)

### 4.2 테마 삭제 실패 (외래키 제약)
- **문제**: 테마 삭제 시 외래키 제약 위반 에러 (news_data 테이블 참조)
- **우선순위**: 높음
- **예상 작업**: 
  - 삭제 전 관련 news_data 확인
  - CASCADE 삭제 옵션 또는 관련 데이터 처리 로직 추가
  - 사용자에게 관련 데이터 존재 시 안내

### 4.3 테마 생성 불가
- **문제**: 테마 생성 기능 작동 안 함
- **우선순위**: 높음
- **예상 작업**: 
  - API 엔드포인트 확인
  - 입력 데이터 검증
  - 에러 핸들링 개선

### 4.4 테마 수정 불가
- **문제**: 테마 수정 기능 작동 안 함
- **우선순위**: 높음
- **예상 작업**: 
  - 수정 API 엔드포인트 확인
  - 데이터 전송 로직 확인

### 4.5 카드와 상세 내용 불일치
- **문제**: 테마 내용 확인 시, 카드에 표시되는 값과 테마 상세 내용 값이 다름
- **우선순위**: 중간
- **예상 작업**: 
  - 데이터 소스 확인 (카드 vs 상세)
  - 데이터 동기화 로직 점검

---

## 5. 프롬프트 관리

### 5.1 필수값 입력 안내 개선
- **문제**: 다른 탭의 필수값을 입력하지 않고 저장 버튼 클릭 시 필수값 입력 안내가 보이지 않음
- **우선순위**: 중간
- **예상 작업**: 
  - 모든 탭의 필수값 검증 로직 추가
  - snackbar로 명확한 안내 메시지 표시

---

## 6. API 호출관리

### 6.1 API 호출 404 에러
- **문제**: `/api/api-calls/enhanced?` 호출 시 404 not found "API call not found" 에러 발생
- **원인**: testApiCall() 함수 호출 시 파라미터 값(API id)이 없음
- **우선순위**: 높음
- **예상 작업**: 
  - API ID 파라미터 전달 로직 수정
  - 함수 호출 전 파라미터 검증 추가

### 6.2 LuxiaCloud APIs 로드 실패
- **문제**: LuxiaCloud APIs 로드 버튼 작동 안 함
- **우선순위**: 중간
- **예상 작업**: 
  - API 엔드포인트 확인
  - 네트워크 요청 로직 점검
  - 에러 핸들링 추가

### 6.3 OpenAI API 테스트 실패
- **문제**: OPENAI_API_KEY 항목에서 API 테스트 시 "Dynamic require of 'openai' is not supported" 에러 발생
- **우선순위**: 높음
- **예상 작업**: 
  - 동적 require 문제 해결 (ESM/CommonJS 모듈 시스템 확인)
  - OpenAI SDK import 방식 변경

---

## 7. Python 스크립트 관리

### 7.1 필수값 입력 안내 개선
- **문제**: 다른 탭의 필수값을 입력하지 않고 저장 버튼 클릭 시 snackbar가 맨 앞에 위치하지 않아 잘 안 보임
- **우선순위**: 낮음
- **예상 작업**: 
  - snackbar z-index 조정
  - 위치 및 표시 방식 개선

---

## 8. 프롬프트 빌더

### 8.1 Databricks 스키마 로드 문제
- **문제**: Databricks 스키마 선택 부분에 모든 스키마가 표시되지 않음 (default, information_schema만 표시됨)
- **우선순위**: 높음
- **예상 작업**: 
  - Nh_ai 내부 스키마들 호출 로직 추가
  - 스키마 조회 API 확인 및 수정

### 8.2 SQL 변환 결과 표시 문제
- **문제**: 예시 프롬프트 탭 > 전체 시장 현황 요약 카드 영역 클릭 시 `/api/nl-to-sql/convert` 호출하지만:
  - 받아오는 SQL 구문이 이상함
  - UI에 표시되는 부분이 없음
- **우선순위**: 높음
- **예상 작업**: 
  - SQL 변환 로직 확인
  - 결과 표시 UI 컴포넌트 추가

### 8.3 커스텀 프롬프트 SQL 변환 문제
- **문제**: 커스텀 프롬프트 탭에서 SQL 변환 시 값이 이상함 (SQL 변환이 아니라 번역 기능처럼 동작)
- **우선순위**: 높음
- **예상 작업**: 
  - SQL 변환 로직 재검토
  - 프롬프트 엔지니어링 개선

---

## 9. 금융 AI 어시스턴트

### 9.1 채팅 영역 스크롤 처리
- **문제**: 응답이 길어지면 채팅 영역을 벗어나서 표시됨
- **우선순위**: 중간
- **예상 작업**: 
  - 채팅 영역 스크롤 CSS 추가
  - 자동 스크롤 로직 추가

### 9.2 메시지 중복 기록 및 응답 표시 문제
- **문제**: 
  - 질의 후 메시지 전송 시 질의가 두 번 기록됨
  - 응답 채팅 표시가 부자연스러움 (응답 전체가 한 번에 보여짐)
- **우선순위**: 중간
- **예상 작업**: 
  - 메시지 전송 중복 방지 로직 추가
  - 스트리밍 응답 처리 (타이핑 효과) 구현

---

## 10. 로그 분석

### 10.1 로깅 활성화 설정 실패
- **문제**: 로깅 활성화 클릭 시 500 에러로 설정 업데이트 실패 ("Failed to update logging setting")
- **원인**: logging_settings 테이블을 update할 때 외래키 참조 오류
- **우선순위**: 높음
- **예상 작업**: 
  - 외래키 제약 조건 확인
  - 관련 테이블 데이터 존재 여부 확인 후 업데이트

---

## 11. 감사로그관리

### 11.1 필터 검색 적용 안됨
- **문제**: 필터 검색 기능이 작동하지 않음
- **우선순위**: 중간
- **예상 작업**: 
  - 필터 검색 API 확인
  - 프론트엔드 필터 파라미터 전달 로직 확인

---

## 12. Azure 서비스 설정

### 12.1 커스텀 서비스 추가 후 UI 미표시
- **문제**: 커스텀 서비스 탭 > 서비스 추가 시 API 호출은 하지만, 화면에 추가된 서비스가 보이지 않음
- **우선순위**: 중간
- **예상 작업**: 
  - 서비스 목록 조회 및 상태 갱신 로직 추가
  - 컴포넌트 리렌더링 트리거

---

## 13. OpenAI 프로바이더

### 13.1 Standard OpenAI 연결 테스트 실패
- **문제**: Standard OpenAI 연결 테스트 실패 (500 Internal Server Error: Connection error)
- **우선순위**: 높음
- **예상 작업**: 
  - OpenAI API 연결 로직 확인
  - 에러 핸들링 개선
  - 네트워크 타임아웃 설정 확인

---

## 14. AI 시황 생성 테스트

### 14.1 뉴스 데이터 수집 실행 에러
- **문제**: 페이지 하단 뉴스 데이터 수집 실행 버튼 클릭 시 에러 발생 (Response 값이 제대로 안 옴, Syntax Error: Unexpected token '<', "<!DOCTYPE...")
- **우선순위**: 높음
- **예상 작업**: 
  - API 응답 형식 확인 (JSON vs HTML)
  - 에러 응답 처리 로직 추가

### 14.2 WebSocket 연결 실패
- **문제**: 페이지 접속 시 "WebSocket connection to 'ws://localhost:5000/ws' failed" 에러 발생
- **우선순위**: 중간
- **예상 작업**: 
  - WebSocket 서버 URL 환경 변수 확인
  - 프로덕션 환경에 맞는 WebSocket URL 설정

---

## 15. 전체 화면 공통 이슈

### 15.1 TextInput 영역 드래그/전체선택 불가
- **문제**: TextInput 영역 내 작성한 텍스트 드래그 불가, Ctrl+A로 전체 선택도 불가
- **우선순위**: 중간
- **예상 작업**: 
  - TextInput 컴포넌트의 user-select CSS 속성 확인
  - 이벤트 핸들러 확인 (드래그 방지 로직 제거)

### 15.2 사이드바 시스템 상태 표시 문제
- **문제**: 시스템 상태가 장시간 지나면 정상 → 오류로 풀림. 새로고침 시 다시 정상 표기
- **우선순위**: 낮음
- **예상 작업**: 
  - 상태 폴링 로직 확인
  - 상태 정의 Tooltip 추가로 오류에 대한 오해 최소화

### 15.3 최상단 검색 필드 문제
- **문제 1**: 키워드 검색이 잘 안 됨 (예: '호출' 검색 시 'API 호출 관리' 결과가 나오지 않음)
- **문제 2**: 검색어 입력 후 검색 창을 닫고 다시 열면 직전 검색어가 그대로 저장되어 있음
- **우선순위**: 중간
- **예상 작업**: 
  - 검색 알고리즘 개선 (부분 문자열 매칭)
  - 검색어 초기화 로직 추가

---

## 16. 홈 화면

### 16.1 AI 어시스턴트 대화 입력 문제
- **문제**: AI 어시스턴트 대화 입력 시 Ctrl+A 및 드래그로 작성한 대화 전체 선택 불가
- **우선순위**: 중간
- **예상 작업**: 
  - TextInput 컴포넌트의 사용자 선택 제한 로직 제거

### 16.2 대화내역 드래그 불가
- **문제**: 대화내역 드래그 불가 (드래그 가능하거나 복사하기 버튼 있으면 좋을듯)
- **우선순위**: 낮음
- **예상 작업**: 
  - 대화내역 드래그 가능하도록 CSS 수정
  - 또는 복사하기 버튼 추가

### 16.3 스마트 제안 아이콘 상태 확인 불가
- **문제**: 대화 입력 필드 내부의 스마트 제안 보기/숨기기 아이콘 버튼의 On/Off 상태 확인 불가
- **우선순위**: 낮음
- **예상 작업**: 
  - 아이콘 상태 시각적 표시 추가 (색상 변경, 체크 표시 등)

---

## 17. 개인화 대시보드

### 17.1 프로필 조회 404 에러
- **문제**: `/api/personalization/1/profile` 호출 시 `const user = await storage.getUser(userId);`에서 user가 존재하지 않아 404 에러 발생
- **우선순위**: 높음
- **예상 작업**: 
  - 사용자 ID 확인 및 사용자 생성 로직 확인
  - 기본 사용자 데이터 생성 또는 에러 핸들링 개선

### 17.2 빈 화면 및 TypeError
- **문제**: 접속 시 빈 화면이 뜸 - `item.addedAt?.toISOString()`에서 TypeError
- **원인**: Watchlist의 addedAt이 "2025-11-03T11:18:46.839Z"와 같이 String 형태로 반환되기 때문에 toISOString() 호출 시 오류
- **우선순위**: 높음
- **예상 작업**: 
  - 데이터 타입 확인 로직 추가
  - String인 경우 Date 객체로 변환 후 toISOString() 호출

---

## 18. 매매 이력 분석

### 18.1 내보내기 기능 반응 없음
- **문제**: "내보내기" 클릭 시 반응이 없음 (이력이 없기 때문일 수 있음)
- **우선순위**: 낮음
- **예상 작업**: 
  - 이력이 없을 때 "내보낼 데이터가 없습니다" 메시지 표시 (보유 종목 관리 화면처럼)

---

## 19. 관심 종목 관리

### 19.1 주식 검색 TypeError
- **문제**: 주식 검색 시 watchlist-manager.tsx의 `value.toFixed(2)`에서 value가 undefined라서 TypeError 발생
- **우선순위**: 높음
- **예상 작업**: 
  - value가 undefined인 경우 처리 로직 추가
  - 기본값 설정 또는 조건부 처리

### 19.2 웹소켓 연결 끊김 표시
- **문제**: 1번 오류 이후 관심 종목 관리 페이지를 누르면 웹소켓 연결이 끊어진 것으로 나옴
- **우선순위**: 중간
- **예상 작업**: 
  - 에러 발생 후 웹소켓 재연결 로직 추가
  - 에러 복구 메커니즘 구현

---

## 20. 개인화 설정

### 20.1 프로필 저장 실패
- **문제**: 정보 입력 후 "프로필 저장" 클릭 시 "프로필 저장 실패" 발생 (Failed to update profile settings)
- **우선순위**: 높음
- **예상 작업**: 
  - API 에러 로그 확인
  - 데이터베이스 제약 조건 확인

### 20.2 사용자 조회 실패
- **문제**: `/api/personalization/:userId/settings` API 호출 시 `const user = await storage.getUser(userId)`가 실행되는데 user가 존재하지 않음
- **우선순위**: 높음
- **예상 작업**: 
  - 사용자 생성 로직 확인
  - 기본 사용자 데이터 생성 또는 에러 핸들링

---

## 21. ETF 투자가이드 상담

### 21.1 세션 시작 실패
- **문제**: 페이지 접속 시 "세션 시작 실패" 발생
- **원인**: `/api/etf-bot/recommendations?userId=1` 호출 시 `recommends.ts`에서 `const userProfile = storage.getUserRiskProfile(userId)`가 실행되는데 userProfile이 존재하지 않음
- **우선순위**: 높음
- **예상 작업**: 
  - 사용자 프로필 생성 로직 확인
  - 기본 위험 프로필 데이터 생성 또는 에러 핸들링

---

## 22. 워크플로우 모니터링

### 22.1 SQL 쿼리 ID 미설정 에러
- **문제**: 워크플로우 실행 시 "오류: SQL 쿼리 ID가 설정되지 않았습니다" 메시지 발생
- **우선순위**: 중간
- **예상 작업**: 
  - SQL 쿼리 노드 설정 확인
  - 필수 파라미터 검증 로직 추가

---

## 우선순위별 작업 계획

### 우선순위 높음 (즉시 처리 필요)
1. 워크플로우 편집기 - SQL 쿼리 노드 실행 에러
2. 실행 스케줄러 - 상태 업데이트 타이밍 불일치
3. Dictionary 관리 - 새 항목 추가 실패
4. 테마 클러스터 관리 - 테마 삭제/생성/수정 문제
5. API 호출관리 - API 호출 404 에러, OpenAI API 테스트 실패
6. 프롬프트 빌더 - Databricks 스키마 로드, SQL 변환 문제
7. 로그 분석 - 로깅 활성화 설정 실패
8. OpenAI 프로바이더 - 연결 테스트 실패
9. AI 시황 생성 테스트 - 뉴스 데이터 수집 실행 에러
10. 개인화 대시보드 - 프로필 조회 404, 빈 화면 TypeError
11. 관심 종목 관리 - 주식 검색 TypeError
12. 개인화 설정 - 프로필 저장 실패, 사용자 조회 실패
13. ETF 투자가이드 상담 - 세션 시작 실패

### 우선순위 중간 (단기 처리 필요)
1. 워크플로우 편집기 - API 호출 노드 삭제 시 에러
2. 실행 스케줄러 - 스케줄러 중지 후 상태 호출 지속
3. 테마 클러스터 관리 - 필수 요소 검증 안내, 카드-상세 불일치
4. 프롬프트 관리 - 필수값 입력 안내 개선
5. API 호출관리 - LuxiaCloud APIs 로드 실패
6. 금융 AI 어시스턴트 - 스크롤 처리, 메시지 중복
7. 감사로그관리 - 필터 검색 적용 안됨
8. Azure 서비스 설정 - 커스텀 서비스 추가 후 UI 미표시
9. AI 시황 생성 테스트 - WebSocket 연결 실패
10. 전체 화면 공통 - TextInput 드래그/선택 문제, 최상단 검색 필드
11. 홈 화면 - AI 어시스턴트 입력 문제
12. 관심 종목 관리 - 웹소켓 연결 끊김
13. 워크플로우 모니터링 - SQL 쿼리 ID 미설정

### 우선순위 낮음 (장기 개선)
1. Python 스크립트 관리 - 필수값 입력 안내 개선
2. 사이드바 - 시스템 상태 표시 문제
3. 홈 화면 - 대화내역 드래그, 스마트 제안 아이콘 상태
4. 매매 이력 분석 - 내보내기 기능 반응 없음

---

## 작업 진행 방식 제안

### 1단계: 데이터베이스 관련 이슈 해결
- 외래키 제약 조건 확인 및 수정
- 사용자/프로필 데이터 생성 로직 점검
- 관련: Dictionary 관리, 테마 클러스터 관리, 로그 분석, 개인화 관련 화면들

### 2단계: API 엔드포인트 및 에러 핸들링 개선
- 404, 500 에러 발생 원인 분석 및 수정
- 파라미터 검증 로직 추가
- 관련: API 호출관리, 워크플로우 편집기, OpenAI 프로바이더, AI 시황 생성 테스트

### 3단계: UI/UX 개선
- 필수값 검증 및 사용자 안내 강화
- 스크롤, 드래그, 선택 기능 개선
- 관련: 전체 화면 공통 이슈, 프롬프트 관리, Python 스크립트 관리, 테마 클러스터 관리

### 4단계: 비즈니스 로직 개선
- SQL 변환 로직 개선
- 상태 관리 및 동기화 로직 개선
- 관련: 프롬프트 빌더, 실행 스케줄러, 금융 AI 어시스턴트

---

## 예상 작업 시간

- **우선순위 높음**: 약 40-50시간
- **우선순위 중간**: 약 30-40시간
- **우선순위 낮음**: 약 10-15시간
- **총 예상 시간**: 약 80-105시간

---

## 참고사항

1. 모든 작업은 테스트 환경에서 먼저 검증 후 프로덕션 배포
2. 데이터베이스 스키마 변경 시 마이그레이션 스크립트 작성 필요
3. API 변경 시 프론트엔드와 백엔드 동시 수정 필요
4. 외래키 제약 조건 변경 시 신중한 검토 필요

