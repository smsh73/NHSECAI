# 잠재 오류 분석 및 작업 계획

**작성일**: 2025-01-28  
**분석 기준**: 현재 소스코드 전체 분석

---

## 요구사항 및 현황 분석

현재 소스코드는 `ai_trade_console-dev(old)`로부터 수정되어 3가지 주요 오류가 해결되었습니다:
1. TypeScript 오류 해결
2. AI 챗봇 프롬프트 전송 시 connection error 해결
3. Databricks 뉴스기사 검색 오류 해결

이번 분석에서는 현재 코드베이스에 잠재된 오류들을 예측하고, 실제로 문제가 있는 코드들을 모두 수정하는 것을 목표로 합니다.

---

## 핵심 개선 포인트 도출

### 1. 타입 안전성 부족
- **문제**: `any` 타입 과다 사용 (410건 발견)
- **위험도**: 중간
- **영향**: 런타임 오류 가능성 증가, 타입 체크 불가능

### 2. 에러 처리 불완전
- **문제**: 일부 비동기 작업에 에러 처리 누락
- **위험도**: 높음
- **영향**: 예기치 않은 오류 발생 시 서비스 중단

### 3. Null/Undefined 체크 부족
- **문제**: Optional 체이닝 및 null 체크 미흡
- **위험도**: 중간
- **영향**: 런타임 오류 발생 가능

### 4. 하드코딩된 값들
- **문제**: 매직 넘버 및 하드코딩된 문자열
- **위험도**: 낮음
- **영향**: 유지보수성 저하

### 5. 리소스 정리 누락
- **문제**: 데이터베이스 연결, 세션 등 리소스 정리 부족
- **위험도**: 중간
- **영향**: 메모리 누수, 연결 풀 고갈

---

## 솔루션 시나리오 제안

### 시나리오 1: 타입 안전성 개선

**1단계**: 인터페이스 정의 추가
- 주요 서비스 클래스의 반환 타입 명시
- 공통 데이터 구조 인터페이스 정의
- 제네릭 타입 활용

**2단계**: `any` 타입 제거
- 서비스 계층부터 순차적으로 타입 정의
- 우선순위: `azure-databricks.ts`, `ai-api.ts`, `workflow-engine.ts`

**3단계**: 타입 가드 함수 추가
- 런타임 타입 검증 함수 작성
- 안전한 타입 변환 로직 구현

**기대 효과**: TypeScript 컴파일 타임 오류 감지율 100% 달성, 런타임 타입 오류 50% 이상 감소

---

### 시나리오 2: 에러 처리 강화

**1단계**: 누락된 try-catch 블록 추가
- 비동기 작업 주변 에러 처리 보완
- 특히 API 호출, 데이터베이스 쿼리 부분

**2단계**: 커스텀 에러 클래스 도입
- 도메인별 에러 클래스 정의
- 상세한 에러 컨텍스트 포함

**3단계**: 에러 로깅 개선
- 스택 트레이스 포함
- 컨텍스트 정보 추가
- 에러 분류 및 우선순위 설정

**기대 효과**: 예기치 않은 서비스 중단 80% 이상 감소, 디버깅 시간 50% 단축

---

### 시나리오 3: Null 안전성 확보

**1단계**: Optional Chaining 적용
- 객체 속성 접근 시 `?.` 사용
- 배열 접근 시 `?.[]` 사용

**2단계**: Nullish Coalescing 활용
- 기본값 제공 시 `??` 연산자 사용
- `||` 대신 `??` 사용으로 falsy 값 처리 개선

**3단계**: 타입 가드 함수 추가
- `isDefined`, `isNotNull` 등 유틸리티 함수
- 타입 narrowing 개선

**기대 효과**: Null/Undefined 관련 런타임 오류 70% 이상 감소

---

### 시나리오 4: 리소스 관리 개선

**1단계**: 리소스 정리 패턴 도입
- `try-finally` 블록 활용
- `using` 패턴 또는 `dispose` 메서드 구현

**2단계**: 연결 풀 모니터링
- 데이터베이스 연결 상태 추적
- 타임아웃 설정 검증

**3단계**: 메모리 누수 방지
- 이벤트 리스너 정리
- 타이머 정리
- WeakMap 활용

**기대 효과**: 메모리 사용량 안정화, 연결 풀 고갈 방지

---

## 예측되는 오류별 상세 분석

### 오류 카테고리 1: 타입 관련 오류

#### 오류 1-1: `any` 타입으로 인한 타입 불일치

**위치**: 
- `server/services/azure-databricks.ts` (19건)
- `server/services/workflow-engine.ts` (24건)
- `server/services/workflow-execution-engine.ts` (51건)
- `server/services/rag.ts` (25건)

**문제 코드 예시**:
```typescript
// server/services/workflow-engine.ts
private async executePromptNode(node: WorkflowNode, inputData: any): Promise<NodeExecutionResult> {
  const config = node.configuration as any;
  // ...
}
```

**예상 오류**:
- 런타임에 존재하지 않는 속성 접근
- 타입이 다른 값 할당
- 컴파일 타임 체크 불가

**작업 계획**:
1. `NodeConfiguration` 인터페이스 정의
2. `inputData` 타입 명시
3. 타입 가드 함수 추가
4. 단계별 리팩토링 (1개 파일씩)

**우선순위**: 높음

---

#### 오류 1-2: 반환 타입 명시 부족

**위치**: 
- `server/services/azure-databricks.ts`
- `server/services/ai-market-analysis.ts`

**문제 코드 예시**:
```typescript
// server/services/azure-databricks.ts
async executeQuery(sql: string): Promise<any> {
  // 반환 타입이 any로 명시됨
}
```

**예상 오류**:
- 반환값 타입 체크 불가
- IDE 자동완성 기능 제한

**작업 계획**:
1. `QueryResult` 인터페이스 활용
2. 반환 타입 명시
3. 타입 추론 개선

**우선순위**: 중간

---

### 오류 카테고리 2: 에러 처리 관련 오류

#### 오류 2-1: 비동기 작업 에러 처리 누락

**위치**:
- `server/routes.ts` (executeDataSourceNode 함수 내)
- `server/services/workflow-engine.ts`

**문제 코드 예시**:
```typescript
// server/routes.ts (14509줄)
const response = await fetch(processedUrl);
// 에러 처리 없이 바로 사용
if (!response.ok) {
  throw new Error(`HTTP ${response.status}: ${response.statusText}`);
}
```

**예상 오류**:
- 네트워크 오류 시 예외 처리되지 않음
- 타임아웃 처리 없음
- 부분적 실패 처리 없음

**작업 계획**:
1. 모든 fetch 호출에 try-catch 추가
2. 타임아웃 설정 추가
3. 재시도 로직 구현
4. Fallback 메커니즘 추가

**우선순위**: 매우 높음

---

#### 오류 2-2: 에러 메시지 부족

**위치**: 전체 코드베이스

**문제 코드 예시**:
```typescript
catch (error: any) {
  console.error('Error:', error);
  // 컨텍스트 정보 부족
}
```

**예상 오류**:
- 디버깅 어려움
- 에러 원인 파악 불가

**작업 계획**:
1. 구조화된 에러 로깅 도입
2. 에러 컨텍스트 정보 추가
3. 스택 트레이스 포함
4. 에러 분류 시스템 구축

**우선순위**: 중간

---

### 오류 카테고리 3: Null/Undefined 관련 오류

#### 오류 3-1: Optional Chaining 미사용

**위치**: 전체 코드베이스

**문제 코드 예시**:
```typescript
// server/services/azure-databricks.ts
const data = result.data.map((row: any) => ({
  id: row.id || row.ID,  // row가 null일 경우 오류
  // ...
}));
```

**예상 오류**:
- `Cannot read property 'id' of undefined`
- 중첩 객체 접근 시 오류

**작업 계획**:
1. Optional Chaining (`?.`) 적용
2. Nullish Coalescing (`??`) 적용
3. 기본값 제공
4. 타입 가드 함수 추가

**우선순위**: 높음

---

#### 오류 3-2: 배열 접근 안전성 부족

**위치**: 
- `server/services/azure-databricks.ts`
- `server/services/ai-market-analysis.ts`

**문제 코드 예시**:
```typescript
const content = data.choices[0].message.content;
// data.choices가 빈 배열일 경우 오류
```

**예상 오류**:
- `Cannot read property 'message' of undefined`
- 배열 인덱스 범위 초과

**작업 계획**:
1. 배열 길이 검증 추가
2. Optional Chaining 적용
3. 기본값 제공
4. 타입 가드 함수 활용

**우선순위**: 높음

---

### 오류 카테고리 4: 리소스 관리 관련 오류

#### 오류 4-1: 데이터베이스 연결 정리 누락

**위치**: 
- `server/services/azure-databricks.ts`
- `server/services/azure-postgresql.ts`

**문제 코드 예시**:
```typescript
async executeQuery(sql: string): Promise<QueryResult> {
  await this.initialize();
  // 연결 정리 없음
}
```

**예상 오류**:
- 연결 풀 고갈
- 메모리 누수
- 타임아웃 발생

**작업 계획**:
1. `try-finally` 블록 추가
2. 연결 정리 메서드 호출
3. 타임아웃 설정
4. 연결 풀 모니터링

**우선순위**: 중간

---

#### 오류 4-2: 세션 정리 누락

**위치**: 
- `server/services/workflow-execution-engine.ts`
- `server/services/session-data-manager.ts`

**문제 코드 예시**:
```typescript
async executeWorkflow(sessionId: string): Promise<{ success: boolean; result?: any; error?: string }> {
  const context = this.activeSessions.get(sessionId);
  // 세션 정리 로직 없음
}
```

**예상 오류**:
- 메모리 누수
- 세션 데이터 누적
- 성능 저하

**작업 계획**:
1. 세션 만료 메커니즘 구현
2. 정기적인 정리 작업 스케줄링
3. WeakMap 활용 검토
4. 메모리 사용량 모니터링

**우선순위**: 중간

---

### 오류 카테고리 5: 비즈니스 로직 관련 오류

#### 오류 5-1: 입력값 검증 부족

**위치**: 
- `server/routes/ai-chat.ts`
- `server/services/workflow-engine.ts`

**문제 코드 예시**:
```typescript
// server/routes/ai-chat.ts
const { message, sessionId: existingSessionId, userId, context = 'financial', model = getChatModelName(), stream = false } = req.body;
// 입력값 검증 없이 사용
```

**예상 오류**:
- 잘못된 입력값 처리 불가
- SQL Injection 가능성
- XSS 공격 가능성

**작업 계획**:
1. Zod 스키마 검증 추가
2. 입력값 정규화
3. Sanitization 로직 추가
4. 타입 체크 강화

**우선순위**: 매우 높음

---

#### 오류 5-2: 경쟁 조건(Race Condition)

**위치**: 
- `server/services/workflow-execution-engine.ts`
- `server/services/session-data-manager.ts`

**문제 코드 예시**:
```typescript
// 동시에 같은 세션에 접근할 경우
const session = this.activeSessions.get(sessionId);
session.messages.push(message);  // 경쟁 조건 가능
```

**예상 오류**:
- 데이터 불일치
- 동시성 문제
- 상태 불일치

**작업 계획**:
1. 락(Lock) 메커니즘 도입
2. 트랜잭션 처리
3. 불변 데이터 구조 활용
4. 동시성 테스트 추가

**우선순위**: 낮음 (현재 단일 서버 환경)

---

## 작업 계획 요약

### 단계 1: 긴급 수정 (1주일)

1. **에러 처리 강화** (2일)
   - 비동기 작업 try-catch 추가
   - 커스텀 에러 클래스 도입
   - 에러 로깅 개선

2. **Null 안전성 확보** (2일)
   - Optional Chaining 적용
   - 배열 접근 안전성 강화
   - 기본값 제공

3. **입력값 검증** (1일)
   - Zod 스키마 추가
   - 입력값 정규화

### 단계 2: 중요 개선 (2주일)

4. **타입 안전성 개선** (1주일)
   - 주요 서비스 클래스 타입 정의
   - `any` 타입 제거
   - 인터페이스 정의

5. **리소스 관리 개선** (1주일)
   - 연결 정리 로직 추가
   - 세션 만료 메커니즘
   - 메모리 관리

### 단계 3: 추가 개선 (1주일)

6. **코드 품질 개선** (1주일)
   - 하드코딩 값 제거
   - 매직 넘버 상수화
   - 코드 리뷰 및 리팩토링

---

## 우선순위 매트릭스

| 오류 카테고리 | 위험도 | 영향 범위 | 우선순위 | 예상 소요 시간 |
|-------------|--------|----------|---------|--------------|
| 에러 처리 강화 | 매우 높음 | 전체 | 1 | 2일 |
| 입력값 검증 | 매우 높음 | API 엔드포인트 | 2 | 1일 |
| Null 안전성 | 높음 | 전체 | 3 | 2일 |
| 타입 안전성 | 중간 | 개발 생산성 | 4 | 1주일 |
| 리소스 관리 | 중간 | 성능/안정성 | 5 | 1주일 |

---

## 기대 효과

1. **안정성 향상**: 예기치 않은 오류 80% 이상 감소
2. **개발 생산성 향상**: 타입 안전성으로 개발 속도 30% 향상
3. **디버깅 시간 단축**: 구조화된 에러 로깅으로 디버깅 시간 50% 단축
4. **코드 품질 향상**: 유지보수성 및 확장성 개선
5. **보안 강화**: 입력값 검증으로 보안 취약점 제거

---

---

## 페이지별 실제 발견된 문제 (CSV 데이터 기반)

### 오류 카테고리 6: 프론트엔드 페이지별 오류

#### 페이지 6-1: 워크플로우 편집기 (`/workflow-editor`)

**증상 및 작업 요청**:
1. 워크플로우 에디터에서 노드를 추가했는데 속성정보가 부정확하여 에러 발생
   - 속성정보 스키마 일치여부 점검 필요
2. 워크플로우 에디터 페이지를 처음 로딩했을 때 또는 새 워크플로우 시작 시 반드시 시작 노드를 워크플로우 에디터에 자동으로 추가
3. 워크플로우 노드를 삭제하는 기능이 현재 없음
   - 워크플로우 노드 삭제 시 연결된 노드들과 constraint 및 dependency를 검토하여 사용자에게 추천 액션 제안 필요
   - 예시: "이 노드는 ~ 하는 노드입니다. 만약에 삭제 시 ~ 영향을 받을 수 있습니다. 그래도 삭제 하시겠습니까?"

**예상 원인**:
- 노드 속성 스키마 검증 로직 부족
- 초기화 로직에서 시작 노드 자동 추가 로직 누락
- 노드 삭제 기능 미구현
- 의존성 체크 로직 없음

**작업 계획**:
1. 노드 속성 스키마 검증 로직 추가 (`client/src/pages/workflow-editor.tsx`)
2. 워크플로우 초기화 시 시작 노드 자동 추가 로직 구현
3. 노드 삭제 기능 구현
4. 노드 의존성 체크 및 영향도 분석 로직 구현
5. 삭제 확인 다이얼로그 개선

**우선순위**: 매우 높음

**예상 소요 시간**: 3일

---

#### 페이지 6-2: 대시보드 (`/dashboard`)

**증상 및 작업 요청**:
1. Azure 서비스 연결상태 카드의 폭이 AI 지능형 검색 카드의 폭과 일치하도록 수정 필요
2. AI 지능형 검색에서 프롬프트를 입력하면 결과가 항상 0개임
   - Trace를 하여 어느 구간에서 데이터를 누락시키는지, API를 잘못 호출하는지, 데이터소스를 잘못 찾거나 쿼리가 잘못되었는지 확인 필요

**예상 원인**:
- 레이아웃 CSS 불일치
- AI 검색 API 호출 오류 또는 데이터 처리 오류
- 쿼리 로직 문제

**작업 계획**:
1. 대시보드 레이아웃 CSS 수정 (`client/src/pages/dashboard.tsx`)
2. AI 지능형 검색 API 호출 로그 추가 및 트레이스
3. 데이터 처리 파이프라인 검증
4. 쿼리 로직 검증 및 수정

**우선순위**: 높음

**예상 소요 시간**: 2일

---

#### 페이지 6-3: 시장현황/홈 화면 (`/`)

**증상 및 작업 요청**:
1. 메인페이지(시장현황)에서 AI 어시스턴트가 connection error 실패 오류 발생
   - OpenAI 호출 코드 확인 필요
   - ✅ **해결됨**: `server/routes/ai-chat.ts`에서 Azure OpenAI fallback 로직 추가
2. 최신분석결과 섹션에서 분석시작을 클릭하면 뉴스ID가 없다고 나옴
   - 뉴스ID가 제대로 검색이 안되는지, 실제로 뉴스ID가 없는지 추적 검사 필요
3. AI시황생성시작 버튼을 누르면 `/ai-market-analysis` 페이지의 시황생성 테스트 로직에 맞추어서 시황데이터를 생성하여 현재 화면에 표시
4. AI 어시스턴트 대화 입력 시 Ctrl+A 및 드래그로 작성한 대화 전체선택 불가
5. 대화내역 드래그 불가
6. 대화 입력 필드 내부의 파일첨부 버튼 및 녹음 아이콘 버튼이 계속 비활성화되어 있음
7. 대화 입력 필드 내부의 스마트 제안 보기/숨기기 아이콘 버튼의 On/Off 상태 확인 불가

**예상 원인**:
- 뉴스 데이터 조회 로직 오류
- 시황 생성 기능 미구현
- UI 인터랙션 이벤트 처리 부족
- 버튼 활성화 로직 누락

**작업 계획**:
1. 뉴스ID 조회 로직 검증 및 수정 (`server/routes.ts`, `server/services/azure-databricks.ts`)
2. 시황 생성 기능 구현 및 홈 화면 연동 (`client/src/pages/home.tsx`)
3. UI 인터랙션 이벤트 처리 추가 (전체선택, 드래그)
4. 파일첨부 및 녹음 기능 활성화
5. 스마트 제안 토글 상태 표시 개선

**우선순위**: 매우 높음

**예상 소요 시간**: 4일

---

#### 페이지 6-4: 전체뉴스 (`/news`)

**증상 및 작업 요청**:
1. 뉴스의 카드배치보다, 뉴스 목록 및 뉴스 데이터 바로가기 링크 형태의 리스트뷰 구조로 수정 필요
2. 뉴스 데이터가 mock 데이터인지 확인 필요
3. 뉴스 카드에 있는 날짜가 오늘(11월2일) 날짜보다 하루 빠른 11월3일로 되어 있음 (mock 데이터인지 확인 필요)

**예상 원인**:
- UI 레이아웃 구조 변경 필요
- 데이터 소스 확인 필요
- 날짜 계산 오류 또는 mock 데이터 사용

**작업 계획**:
1. 뉴스 목록 UI를 리스트뷰로 변경 (`client/src/pages/news.tsx`)
2. 뉴스 데이터 소스 확인 (Databricks vs PostgreSQL vs Mock)
3. 날짜 처리 로직 검증 및 수정
4. 데이터 바로가기 링크 구현

**우선순위**: 중간

**예상 소요 시간**: 2일

---

#### 페이지 6-5: AI시황생성테스트 (`/ai-market-analysis`)

**증상 및 작업 요청**:
1. 전체워크플로우 실행 버튼을 누르면 첫 번째 뉴스데이터 수집 단계의 워크플로우가 실패하고 종료됨
2. 리프레시 버튼을 누르면 `/ai-market-analysis`로 리다이렉션 되면서 화면에 아무것도 로딩이 안됨
3. 각각의 개별 워크플로우를 실행시키면 모두 에러가 발생
   - 뉴스데이터 수집 단계의 워크플로우를 개별 실행시키면 `/ai-market-analysis` 페이지로 리다이렉션 되면서 화면에 아무것도 로딩이 안되는 현상 발생

**예상 원인**:
- 워크플로우 실행 엔진 오류
- 뉴스 데이터 수집 로직 오류
- 페이지 리로딩 로직 오류
- 에러 처리 부족

**작업 계획**:
1. 워크플로우 실행 엔진 에러 처리 강화 (`server/services/workflow-execution-engine.ts`)
2. 뉴스 데이터 수집 로직 검증 및 수정 (`server/services/ai-market-analysis.ts`)
3. 페이지 리로딩 로직 수정 (`client/src/pages/AIMarketAnalysis.tsx`)
4. 개별 워크플로우 실행 에러 처리 추가
5. 상세 에러 로깅 및 사용자 피드백 개선

**우선순위**: 매우 높음

**예상 소요 시간**: 4일

---

#### 페이지 6-6: 스키마브라우저 (`/schema-browser`)

**증상 및 작업 요청**:
1. 페이지 로딩이 안됨
   - ✅ **개선됨**: 11월 2일 일요일 오후 7시 57분경, 페이지 로딩 되는 것 확인함
   - 다만, 로딩이 조금 느린 경우가 있었음

**예상 원인**:
- 데이터 조회 로직 성능 문제
- 대용량 스키마 데이터 로딩
- 비동기 로딩 처리 부족

**작업 계획**:
1. 스키마 조회 로직 최적화 (`server/routes.ts`, `client/src/pages/schema-browser.tsx`)
2. 페이지네이션 또는 가상 스크롤 구현
3. 로딩 인디케이터 개선
4. 데이터 캐싱 구현

**우선순위**: 중간

**예상 소요 시간**: 2일

---

#### 페이지 6-7: Dictionary관리 (`/dictionary-manager`)

**증상 및 작업 요청**:
1. 페이지 로딩이 안됨

**예상 원인**:
- API 호출 오류
- 데이터 조회 실패
- 컴포넌트 렌더링 오류

**작업 계획**:
1. Dictionary API 엔드포인트 검증 (`server/routes.ts`)
2. 데이터 조회 로직 검증 (`server/storage.ts`)
3. 프론트엔드 컴포넌트 에러 처리 추가 (`client/src/pages/dictionary-manager.tsx`)
4. 에러 로깅 추가

**우선순위**: 높음

**예상 소요 시간**: 1일

---

#### 페이지 6-8: API관리 (`/api-management`)

**증상 및 작업 요청**:
1. 페이지 로딩이 안됨

**예상 원인**:
- API 호출 오류
- 데이터 조회 실패
- 컴포넌트 렌더링 오류

**작업 계획**:
1. API 관리 API 엔드포인트 검증 (`server/routes.ts`)
2. 데이터 조회 로직 검증
3. 프론트엔드 컴포넌트 에러 처리 추가 (`client/src/pages/api-management.tsx`)
4. 에러 로깅 추가

**우선순위**: 높음

**예상 소요 시간**: 1일

---

#### 페이지 6-9: 금융AI어시스턴트 (`/financial-chatbot`)

**증상 및 작업 요청**:
1. 프롬프트 전송 시 connection error 메시지가 대화창에 표시됨
   - ✅ **해결됨**: `server/routes/ai-chat.ts`에서 Azure OpenAI fallback 로직 추가

**우선순위**: 완료

---

#### 페이지 6-10: 스키마 의미 맵핑 (`/schema-mapper`)

**증상 및 작업 요청**:
1. 스키마 목록에 Databricks의 스키마가 조회되지 않고 있음

**예상 원인**:
- Databricks 스키마 조회 API 오류
- 데이터 필터링 오류
- 스키마 목록 조회 로직 문제

**작업 계획**:
1. Databricks 스키마 조회 로직 검증 (`server/services/azure-databricks.ts`)
2. 스키마 목록 API 검증 (`server/routes.ts`)
3. 프론트엔드 스키마 필터링 로직 검증 (`client/src/pages/schema-mapper.tsx`)
4. Databricks 연결 상태 확인

**우선순위**: 높음

**예상 소요 시간**: 2일

---

#### 페이지 6-11: Azure 서비스 설정 > 커스텀 서비스 (`/azure-config`)

**증상 및 작업 요청**:
1. 서비스 추가, 수정, 삭제 기능이 동작하고 있지 않음
   - 화면상에서 작동하는 것처럼 보이지만 API 호출 없음

**예상 원인**:
- API 호출 로직 누락
- 이벤트 핸들러 미연결
- API 엔드포인트 오류

**작업 계획**:
1. 서비스 CRUD API 엔드포인트 검증 (`server/routes.ts`)
2. 프론트엔드 이벤트 핸들러 확인 (`client/src/pages/azure-config.tsx`)
3. API 호출 로직 추가/수정
4. 에러 처리 및 피드백 개선

**우선순위**: 높음

**예상 소요 시간**: 2일

---

## 업데이트된 작업 계획 요약

### 단계 1: 긴급 수정 (2주일)

1. **페이지 로딩 오류 해결** (3일)
   - Dictionary관리 페이지 로딩 문제 해결
   - API관리 페이지 로딩 문제 해결
   - 스키마브라우저 성능 개선

2. **워크플로우 편집기 기능 구현** (3일)
   - 노드 속성 스키마 검증
   - 시작 노드 자동 추가
   - 노드 삭제 기능 및 의존성 체크

3. **시장현황/홈 화면 기능 구현** (4일)
   - 뉴스ID 조회 로직 수정
   - 시황 생성 기능 구현 및 연동
   - UI 인터랙션 개선 (전체선택, 드래그, 버튼 활성화)

4. **AI시황생성테스트 워크플로우 오류 해결** (4일)
   - 워크플로우 실행 엔진 에러 처리 강화
   - 뉴스 데이터 수집 로직 수정
   - 페이지 리로딩 로직 개선

### 단계 2: 중요 개선 (2주일)

5. **대시보드 레이아웃 및 AI 검색 수정** (2일)
   - 레이아웃 CSS 수정
   - AI 지능형 검색 트레이스 및 수정

6. **스키마 의미 맵핑 Databricks 스키마 조회** (2일)
   - Databricks 스키마 조회 로직 검증
   - 스키마 목록 API 수정

7. **Azure 서비스 설정 CRUD 기능** (2일)
   - API 엔드포인트 검증
   - 프론트엔드 이벤트 핸들러 수정

8. **전체뉴스 리스트뷰 구조 변경** (2일)
   - UI 구조 변경
   - 데이터 소스 확인 및 날짜 처리 수정

9. **에러 처리 강화** (2일)
   - 비동기 작업 try-catch 추가
   - 커스텀 에러 클래스 도입
   - 에러 로깅 개선

### 단계 3: 추가 개선 (1주일)

10. **Null 안전성 확보** (2일)
    - Optional Chaining 적용
    - 배열 접근 안전성 강화

11. **타입 안전성 개선** (3일)
    - 주요 서비스 클래스 타입 정의
    - `any` 타입 제거

12. **리소스 관리 개선** (2일)
    - 연결 정리 로직 추가
    - 세션 만료 메커니즘

---

## 업데이트된 우선순위 매트릭스

| 오류 카테고리 | 위험도 | 영향 범위 | 우선순위 | 예상 소요 시간 | 상태 |
|-------------|--------|----------|---------|--------------|------|
| 워크플로우 편집기 기능 | 매우 높음 | 사용자 워크플로우 관리 | 1 | 3일 | 대기 |
| 시장현황/홈 화면 기능 | 매우 높음 | 메인 페이지 | 2 | 4일 | 대기 |
| AI시황생성테스트 오류 | 매우 높음 | 핵심 기능 | 3 | 4일 | 대기 |
| 페이지 로딩 오류 | 높음 | Dictionary, API 관리 | 4 | 3일 | 대기 |
| 대시보드 레이아웃/AI 검색 | 높음 | 대시보드 | 5 | 2일 | 대기 |
| 스키마 의미 맵핑 | 높음 | 스키마 관리 | 6 | 2일 | 대기 |
| Azure 서비스 설정 CRUD | 높음 | 설정 관리 | 7 | 2일 | 대기 |
| 전체뉴스 리스트뷰 | 중간 | 뉴스 조회 | 8 | 2일 | 대기 |
| 에러 처리 강화 | 중간 | 전체 | 9 | 2일 | 대기 |
| Null 안전성 | 중간 | 전체 | 10 | 2일 | 대기 |
| 타입 안전성 | 중간 | 개발 생산성 | 11 | 3일 | 대기 |
| 리소스 관리 | 낮음 | 성능/안정성 | 12 | 2일 | 대기 |

---

## 시스템 로그 분석 결과 (system_logs_2025-11-02.json 기반)

### 로그 분석 개요
- **총 로그 항목 수**: 67,584건
- **분석 기간**: 2025-11-02
- **주요 엔드포인트 호출 횟수**:
  - `/api/azure/services/status`: 971회 (가장 빈번한 호출)
  - `/api/ai-market-analysis/news-collection-status`: 7회
  - `/api/azure/databricks/schema`: 2회
  - 기타 Databricks 관련 API: 각 2회

### 오류 카테고리 7: 성능 및 로깅 관련 오류

#### 오류 7-1: Databricks 스키마 조회 성능 문제

**증상**:
- `/api/azure/databricks/schema` 엔드포인트 실행 시간이 평균 22,253ms (약 22초)
- 사용자가 스키마 브라우저 페이지에서 매우 느린 응답 경험

**로그 데이터**:
```json
{
  "count": 2,
  "avgExecutionTime": 22253,
  "maxExecutionTime": 22253,
  "minExecutionTime": 22253
}
```

**예상 원인**:
- Databricks Unity Catalog 조회 로직이 비효율적
- 대량의 스키마 정보를 한 번에 조회
- 캐싱 메커니즘 부재
- 네트워크 지연 또는 Databricks 클러스터 성능 문제

**작업 계획**:
1. Databricks 스키마 조회 로직 최적화 (`server/services/azure-databricks.ts`)
2. 페이지네이션 또는 지연 로딩 구현
3. 스키마 정보 캐싱 메커니즘 추가 (Redis 또는 메모리 캐시)
4. 쿼리 최적화 및 필요한 필드만 조회
5. 로딩 인디케이터 및 진행 상태 표시 개선

**우선순위**: 높음

**예상 소요 시간**: 2일

---

#### 오류 7-2: Azure 서비스 상태 체크 성능 문제

**증상**:
- `/api/azure/services/status` 엔드포인트가 1초 이상 소요되는 경우 발생
- 최대 1,599ms까지 소요되는 경우 확인
- 평균 응답 시간이 약 1,231ms (정상적인 응답 시간 대비 높음)

**로그 데이터**:
```json
{
  "count": 5,
  "avgExecutionTime": 1231.4,
  "maxExecutionTime": 1599,
  "examples": [
    { "timestamp": "2025-11-02T20:40:57.728Z", "executionTimeMs": 1053 },
    { "timestamp": "2025-11-02T20:35:51.887Z", "executionTimeMs": 1072 },
    { "timestamp": "2025-11-02T18:01:43.814Z", "executionTimeMs": 1390 }
  ]
}
```

**예상 원인**:
- 여러 Azure 서비스(OpenAI, AI Search, CosmosDB, Databricks, PostgreSQL)를 순차적으로 체크
- 각 서비스별 연결 체크가 동기적으로 수행됨
- 네트워크 지연 누적
- 캐싱 메커니즘 부재

**작업 계획**:
1. 병렬 처리로 변경 (`Promise.all` 활용)
2. 서비스 상태 체크 캐싱 구현 (TTL 30초 ~ 1분)
3. 타임아웃 설정 추가 (각 서비스별 최대 대기 시간 제한)
4. 비동기 처리 및 응답 개선
5. 성능 모니터링 및 알림 추가

**우선순위**: 중간

**예상 소요 시간**: 1일

---

#### 오류 7-3: 뉴스 수집 상태 API 로깅 누락

**증상**:
- `/api/ai-market-analysis/news-collection-status` 엔드포인트의 로그에서 `status`, `httpStatusCode`, `executionTimeMs`가 `null`인 경우 7건 이상 확인
- 로그 기록이 불완전하여 디버깅 및 모니터링 어려움

**로그 데이터**:
```json
{
  "count": 7,
  "examples": [
    {
      "timestamp": "2025-11-02T19:30:18.118Z",
      "status": null,
      "httpStatusCode": null,
      "executionTimeMs": null
    }
  ]
}
```

**예상 원인**:
- 로깅 미들웨어에서 요청 로그만 기록하고 응답 로그를 기록하지 않음
- 에러 발생 시 로깅이 누락됨
- 비동기 작업 완료 전에 로그가 기록됨

**작업 계획**:
1. 로깅 미들웨어에서 응답 로그 기록 보장 (`server/index.ts`, `server/routes.ts`)
2. 에러 발생 시에도 로그 기록되도록 개선
3. 비동기 작업 완료 후 로깅 처리
4. 로그 필드 검증 및 기본값 설정
5. 로깅 테스트 케이스 추가

**우선순위**: 중간

**예상 소요 시간**: 1일

---

#### 오류 7-4: Databricks Delta Table 조회 성능 문제

**증상**:
- `/api/azure/databricks/delta-table/nh_ai/bronze/e900s_raw`: 2,255ms
- `/api/azure/databricks/delta-table/nh_ai/bronze/kri1_raw`: 1,520ms
- Delta Table 메타데이터 조회가 2초 이상 소요

**예상 원인**:
- Delta Lake 메타데이터 조회 쿼리 비효율
- 테이블 스키마가 크거나 복잡함
- 네트워크 지연

**작업 계획**:
1. Delta Table 메타데이터 조회 쿼리 최적화
2. 캐싱 메커니즘 추가
3. 필요한 정보만 조회하도록 쿼리 수정
4. 타임아웃 설정 및 재시도 로직 추가

**우선순위**: 낮음

**예상 소요 시간**: 1일

---

### 오류 카테고리 8: 로깅 및 모니터링 개선 필요

#### 오류 8-1: 에러 로그 부재

**증상**:
- 전체 로그 67,584건 중 `logLevel: "error"`인 로그가 0건
- `errorMessage`가 null이 아닌 로그가 없음
- `httpStatusCode`가 400 이상인 로그가 없음

**예상 원인**:
- 에러 발생 시 로깅이 제대로 되지 않음
- 에러 처리가 try-catch로 감싸져 있어 에러가 로그에 기록되지 않음
- 로깅 레벨 설정 문제

**작업 계획**:
1. 에러 발생 시 명시적으로 에러 로그 기록
2. 로깅 레벨 검증 (`error`, `warn` 레벨 로그 확인)
3. 에러 핸들링 시 로깅 추가
4. 로깅 시스템 검증 및 테스트

**우선순위**: 높음

**예상 소요 시간**: 1일

---

#### 오류 8-2: 로그 데이터 일관성 문제

**증상**:
- 일부 로그에서 필수 필드(`status`, `httpStatusCode`, `executionTimeMs`)가 null
- 요청 로그는 있으나 응답 로그가 없는 경우
- 로그 타입(`logType`)과 실제 데이터 불일치 가능

**예상 원인**:
- 비동기 로깅 처리 문제
- 로깅 미들웨어에서 응답 전에 로그 기록
- 에러 발생 시 로깅 중단

**작업 계획**:
1. 로깅 미들웨어 개선 (`server/index.ts`)
2. 응답 로깅 보장 (response interceptor)
3. 로그 필드 검증 로직 추가
4. 로그 데이터 일관성 테스트 추가

**우선순위**: 중간

**예상 소요 시간**: 1일

---

## 업데이트된 작업 계획 요약 (로그 분석 반영)

### 단계 1: 긴급 수정 (2주일 + 4일)

1. **페이지 로딩 오류 해결** (3일)
   - Dictionary관리 페이지 로딩 문제 해결
   - API관리 페이지 로딩 문제 해결
   - 스키마브라우저 성능 개선

2. **워크플로우 편집기 기능 구현** (3일)
   - 노드 속성 스키마 검증
   - 시작 노드 자동 추가
   - 노드 삭제 기능 및 의존성 체크

3. **시장현황/홈 화면 기능 구현** (4일)
   - 뉴스ID 조회 로직 수정
   - 시황 생성 기능 구현 및 연동
   - UI 인터랙션 개선 (전체선택, 드래그, 버튼 활성화)

4. **AI시황생성테스트 워크플로우 오류 해결** (4일)
   - 워크플로우 실행 엔진 에러 처리 강화
   - 뉴스 데이터 수집 로직 수정
   - 페이지 리로딩 로직 개선

5. **Databricks 스키마 조회 성능 개선** (2일) - **새로 추가**
   - 스키마 조회 로직 최적화
   - 캐싱 메커니즘 구현
   - 페이지네이션 또는 지연 로딩

6. **로깅 시스템 개선** (1일) - **새로 추가**
   - 에러 로깅 보장
   - 로그 데이터 일관성 개선

### 단계 2: 중요 개선 (2주일 + 2일)

7. **대시보드 레이아웃 및 AI 검색 수정** (2일)
   - 레이아웃 CSS 수정
   - AI 지능형 검색 트레이스 및 수정

8. **Azure 서비스 상태 체크 성능 개선** (1일) - **새로 추가**
   - 병렬 처리 구현
   - 캐싱 메커니즘 추가

9. **스키마 의미 맵핑 Databricks 스키마 조회** (2일)
   - Databricks 스키마 조회 로직 검증
   - 스키마 목록 API 수정

10. **Azure 서비스 설정 CRUD 기능** (2일)
    - API 엔드포인트 검증
    - 프론트엔드 이벤트 핸들러 수정

11. **전체뉴스 리스트뷰 구조 변경** (2일)
    - UI 구조 변경
    - 데이터 소스 확인 및 날짜 처리 수정

12. **에러 처리 강화** (2일)
    - 비동기 작업 try-catch 추가
    - 커스텀 에러 클래스 도입
    - 에러 로깅 개선

13. **뉴스 수집 상태 API 로깅 개선** (1일) - **새로 추가**
    - 응답 로깅 보장
    - 로그 필드 검증

### 단계 3: 추가 개선 (1주일 + 1일)

14. **Null 안전성 확보** (2일)
    - Optional Chaining 적용
    - 배열 접근 안전성 강화

15. **타입 안전성 개선** (3일)
    - 주요 서비스 클래스 타입 정의
    - `any` 타입 제거

16. **리소스 관리 개선** (2일)
    - 연결 정리 로직 추가
    - 세션 만료 메커니즘

17. **Delta Table 조회 성능 개선** (1일) - **새로 추가**
    - 쿼리 최적화
    - 캐싱 메커니즘 추가

---

## 업데이트된 우선순위 매트릭스 (로그 분석 반영)

| 오류 카테고리 | 위험도 | 영향 범위 | 우선순위 | 예상 소요 시간 | 상태 |
|-------------|--------|----------|---------|--------------|------|
| 워크플로우 편집기 기능 | 매우 높음 | 사용자 워크플로우 관리 | 1 | 3일 | 대기 |
| 시장현황/홈 화면 기능 | 매우 높음 | 메인 페이지 | 2 | 4일 | 대기 |
| AI시황생성테스트 오류 | 매우 높음 | 핵심 기능 | 3 | 4일 | 대기 |
| Databricks 스키마 조회 성능 | 높음 | 스키마 브라우저 | 4 | 2일 | 대기 |
| 페이지 로딩 오류 | 높음 | Dictionary, API 관리 | 5 | 3일 | 대기 |
| 로깅 시스템 개선 | 높음 | 모니터링/디버깅 | 6 | 1일 | 대기 |
| 대시보드 레이아웃/AI 검색 | 높음 | 대시보드 | 7 | 2일 | 대기 |
| Azure 서비스 상태 체크 성능 | 중간 | 대시보드 | 8 | 1일 | 대기 |
| 스키마 의미 맵핑 | 높음 | 스키마 관리 | 9 | 2일 | 대기 |
| Azure 서비스 설정 CRUD | 높음 | 설정 관리 | 10 | 2일 | 대기 |
| 전체뉴스 리스트뷰 | 중간 | 뉴스 조회 | 11 | 2일 | 대기 |
| 뉴스 수집 상태 로깅 | 중간 | 모니터링 | 12 | 1일 | 대기 |
| 에러 처리 강화 | 중간 | 전체 | 13 | 2일 | 대기 |
| Null 안전성 | 중간 | 전체 | 14 | 2일 | 대기 |
| 타입 안전성 | 중간 | 개발 생산성 | 15 | 3일 | 대기 |
| 리소스 관리 | 낮음 | 성능/안정성 | 16 | 2일 | 대기 |
| Delta Table 성능 | 낮음 | 데이터 조회 | 17 | 1일 | 대기 |

---

## 업데이트된 기대 효과 (로그 분석 반영)

1. **사용자 경험 향상**: 페이지 로딩 문제 해결로 접근성 100% 달성
2. **핵심 기능 안정화**: 워크플로우 실행 오류 해결로 기능 사용성 90% 이상 향상
3. **UI/UX 개선**: 리스트뷰 구조 변경 및 인터랙션 개선으로 사용성 향상
4. **데이터 정확성 향상**: 뉴스ID 조회 및 스키마 조회 오류 해결
5. **기능 완성도 향상**: 노드 삭제, 시황 생성 등 누락된 기능 구현
6. **성능 향상**: Databricks 스키마 조회 시간 22초 → 5초 이하로 단축 (약 77% 개선)
7. **모니터링 개선**: 로깅 시스템 개선으로 에러 추적 및 디버깅 시간 50% 단축
8. **대시보드 응답 속도 개선**: Azure 서비스 상태 체크 시간 1.2초 → 0.5초 이하로 단축 (병렬 처리 및 캐싱)

---

## 다음 단계

1. **이 방향에 대해 어떻게 생각하시나요?**
   - 우선순위 조정이 필요한가요?
   - 추가로 고려해야 할 오류가 있나요?
   - 특정 부분에 집중할 필요가 있나요?

2. **작업 시작 준비**
   - 단계별 작업 시작 승인
   - 테스트 계획 수립
   - 리뷰 프로세스 확정

