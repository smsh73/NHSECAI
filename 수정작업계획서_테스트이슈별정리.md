# 수정 작업 계획서 - 테스트 이슈별 정리

## 문서 개요

본 문서는 테스트 결과를 바탕으로 URL/테스트 화면별로 분류하여 체계적인 수정 작업 계획을 수립합니다.

**작성일**: 2025년 11월 4일  
**대상 환경**: https://app-was-int-dev.azurewebsites.net/

---

## 1. 홈 화면 (AI 어시스턴트)

**URL**: https://app-was-int-dev.azurewebsites.net/  
**테스트 화면명**: 홈

### 1.1 AI 어시스턴트 대화 입력 - 전체 선택 및 드래그 불가
- **문제**: AI 어시스턴트 대화 입력 시 Ctrl+A 및 드래그로 작성한 대화 전체 선택 불가
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/components/chat/ai-chat-interface.tsx`
  - `client/src/components/ui/input.tsx` (공통 Input 컴포넌트)
- **예상 작업**:
  1. Input 컴포넌트에 `user-select: text` CSS 속성 추가
  2. `onSelect` 이벤트 핸들러 확인 및 제거 (드래그 방지 로직이 있다면)
  3. `onKeyDown` 핸들러에서 Ctrl+A 단축키 처리 확인
  4. 테스트: Ctrl+A, 드래그 선택 동작 확인

### 1.2 대화내역 드래그 불가
- **문제**: 대화내역 드래그 불가 (드래그 가능하거나 복사하기 버튼 있으면 좋을듯)
- **우선순위**: 낮음
- **영향 파일**: 
  - `client/src/components/chat/ai-chat-interface.tsx`
- **예상 작업**:
  1. 메시지 영역에 `user-select: text` CSS 속성 추가
  2. 각 메시지에 복사 버튼 추가 (Clipboard 아이콘)
  3. 복사 기능 구현 (`navigator.clipboard.writeText`)
  4. 테스트: 메시지 드래그 및 복사 버튼 동작 확인

### 1.3 스마트 제안 아이콘 상태 확인 불가
- **문제**: 대화 입력 필드 내부의 스마트 제안 보기/숨기기 아이콘 버튼의 On/Off 상태 확인 불가
- **우선순위**: 낮음
- **영향 파일**: 
  - `client/src/components/chat/ai-chat-interface.tsx`
- **예상 작업**:
  1. 아이콘 상태에 따른 시각적 구분 추가 (색상 변경, 배경색, 체크 표시 등)
  2. Tooltip 추가하여 상태 명확히 표시
  3. 테스트: 아이콘 클릭 시 상태 변화 확인

### 1.4 대화 전송 시 간헐적 500 에러 (요청 한도 초과)
- **문제**: 대화를 입력하고 전송했을 때 간헐적으로 500 에러 발생 - api/ai-chat api 오류. 요청 한도 초과
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/components/chat/ai-chat-interface.tsx`
  - `server/routes.ts` (AI 채팅 API 엔드포인트)
- **예상 작업**:
  1. API 호출 시 Rate Limit 체크 로직 추가
  2. 에러 응답 처리 개선 (429 Too Many Requests 대응)
  3. 사용자에게 재시도 안내 메시지 표시
  4. 백오프(Exponential Backoff) 재시도 로직 구현
  5. 테스트: Rate Limit 상황 시나리오 테스트

---

## 2. Azure 서비스 설정

**URL**: https://app-was-int-dev.azurewebsites.net/azure-config  
**테스트 화면명**: Azure 서비스 설정

### 2.1 커스텀 서비스 추가 후 UI 미표시
- **문제**: 커스텀 서비스 탭 > 서비스 추가 시 API 호출은 하지만, 화면 UI적으로 추가된 서비스가 보이지 않음
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/azure-config.tsx`
  - `server/routes.ts` (커스텀 서비스 API)
- **예상 작업**:
  1. 서비스 추가 성공 후 `refetchCustomServices()` 호출 확인
  2. `customServices` 상태 업데이트 로직 확인
  3. React Query 캐시 무효화 확인 (`queryClient.invalidateQueries`)
  4. 서비스 목록 렌더링 로직 확인
  5. 테스트: 서비스 추가 후 목록 갱신 확인

---

## 3. 워크플로우 편집기

**URL**: https://app-was-int-dev.azurewebsites.net/workflow-editor  
**테스트 화면명**: 워크플로우 편집기

### 3.1 API 호출 노드 삭제 시 에러
- **문제**: API 호출 노드 드래그 후 삭제 시, "변수명 is not defined" 에러 발생
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/workflow-editor.tsx`
  - `client/src/components/workflow/workflow-canvas.tsx`
  - `server/routes.ts` (워크플로우 노드 삭제 API)
- **예상 작업**:
  1. 노드 삭제 시 변수 참조 정리 로직 확인
  2. 노드 삭제 전 의존성 체크 (변수 참조하는 다른 노드 확인)
  3. 변수명 정리 로직 추가
  4. 에러 핸들링 개선 (try-catch 블록 추가)
  5. 테스트: API 호출 노드 삭제 시나리오 테스트

### 3.2 종료노드에서 Databricks gold 스키마 저장 기능
- **문제**: 종료노드에서 워크플로우의 결과데이터를 databricks의 nh_ai.gold에 저장. gold 스키마에 table명은 워크플로우 ID로 생성. 테이블 Description은 워크플로우 이름 + 설명으로 생성, 결과데이터의 스키마를 추출해서 데이터브릭스 테이블 생성시 저장할수있도록 동일하게 구성
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/components/workflow/workflow-node.tsx` (종료 노드)
  - `server/routes.ts` (워크플로우 실행 API)
  - `server/services/workflow-execution.ts` (결과 저장 로직)
- **예상 작업**:
  1. 종료 노드 설정에서 Databricks 저장 옵션 추가
  2. 워크플로우 실행 완료 시 결과 데이터 스키마 추출 로직 구현
  3. Databricks Unity Catalog API를 사용하여 테이블 생성
  4. 테이블명: `nh_ai.gold.{workflowId}`
  5. 테이블 Description: `{workflowName} - {workflowDescription}`
  6. 스키마 매핑 로직 구현
  7. 테스트: 종료 노드 실행 후 Databricks 테이블 생성 확인

### 3.3 AI 분석 노드 실행 오류
- **문제**: AI 분석 노드 실행시 다음 오류 발생. 오류: 지원하지 않는 노드 타입: ai_analysis
- **우선순위**: 높음
- **영향 파일**: 
  - `server/services/workflow-execution.ts`
  - `client/src/components/workflow/workflow-node.tsx`
- **예상 작업**:
  1. 워크플로우 실행 엔진에서 `ai_analysis` 노드 타입 지원 확인
  2. 노드 타입 처리 로직에 `ai_analysis` 케이스 추가
  3. AI 분석 노드 실행 로직 구현
  4. 테스트: AI 분석 노드 실행 확인

### 3.4 AI 분석 노드 프롬프트 저장 후 표시 문제
- **문제**: AI 분석 노드에서 '분석 프롬프트'를 입력 후 '적용'을 클릭하면 적용되었다는 알림과 함께 프롬프트 내용이 사라짐. 직전에 저장했던 프롬프트 내용을 표시해야함
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/workflow-editor.tsx` (노드 설정 패널)
  - `client/src/components/workflow/node-settings-panel.tsx`
- **예상 작업**:
  1. 프롬프트 적용 후 상태 유지 로직 확인
  2. 노드 데이터에 프롬프트 저장 확인
  3. 노드 설정 패널 열 때 저장된 프롬프트 표시 로직 확인
  4. 테스트: 프롬프트 저장 후 다시 열었을 때 표시 확인

---

## 4. 실행 스케줄러

**URL**: https://app-was-int-dev.azurewebsites.net/scheduler  
**테스트 화면명**: 실행 스케줄러

### 4.1 상태 업데이트 타이밍 불일치
- **문제**: 스케줄러 제어판 항목들의 상태가 계속 왔다갔다하는(대기 ↔ 실행 중) 타이밍과 마지막 실행 시각 업데이트 타이밍이 다름. 코드 상 로직 상세 확인 필요
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/scheduler.tsx`
  - `server/services/scheduler.ts`
  - `server/routes.ts` (스케줄러 상태 API)
- **예상 작업**:
  1. 상태 업데이트 로직 상세 확인 (`scheduler.ts`)
  2. 상태 변경과 마지막 실행 시각 업데이트 동기화
  3. React Query의 `refetchInterval` 설정 확인 및 조정
  4. 상태 업데이트 시 원자적(Atomic) 업데이트 보장
  5. 테스트: 상태 변경 타이밍과 마지막 실행 시각 동기화 확인

### 4.2 스케줄러 중지 후 시작 버튼 500 에러
- **문제**: 스케줄러 중지 후, 시작 버튼을 누르면 /api/scheduler/start 호출시 500 Internal Server Error 발생. 다시 한번 더 누르면 정상작동
- **우선순위**: 높음
- **영향 파일**: 
  - `server/services/scheduler.ts`
  - `server/routes.ts` (스케줄러 시작 API)
- **예상 작업**:
  1. `startScheduler()` 함수에서 중지 상태에서 시작 시 에러 발생 원인 확인
  2. 상태 전환 로직 확인 (중지 → 시작)
  3. 비동기 작업 완료 대기 로직 추가
  4. 에러 핸들링 개선 (상세 에러 로그 추가)
  5. 테스트: 중지 후 시작 시나리오 반복 테스트

---

## 5. Dictionary 관리

**URL**: https://app-was-int-dev.azurewebsites.net/dictionary-manager  
**테스트 화면명**: Dictionary 관리

### 5.1 새 항목 추가 실패 (외래키 제약 위반)
- **문제**: 새 항목 추가 안됨(500 Internal Server Error: insert or update on table "dictionary entries" violates foreign key constraint "dictionary_entries_dictionary_id_dictionaries_id_fk")
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/dictionary-manager.tsx`
  - `server/routes.ts` (Dictionary API)
  - `shared/schema.ts` (데이터베이스 스키마)
- **예상 작업**:
  1. 외래키 제약 조건 확인 (`dictionary_entries.dictionary_id` → `dictionaries.id`)
  2. 항목 추가 시 `dictionary_id` 유효성 검사 추가
  3. Dictionary 존재 여부 확인 로직 추가
  4. 사용자 안내 메시지 개선 (어떤 Dictionary에 추가할지 명확히)
  5. 테스트: 새 항목 추가 시나리오 테스트

---

## 6. 테마 클러스터 관리

**URL**: https://app-was-int-dev.azurewebsites.net/theme-cluster-management  
**테스트 화면명**: 테마 클러스터 관리

### 6.1 필수 요소 검증 안내 부재
- **문제**: 새 테마 추가 시, 필수 요소 작성 안하고 +테마생성 클릭했을 때 별도의 안내가 없음
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/theme-cluster-management.tsx`
- **예상 작업**:
  1. 필수 필드 검증 로직 추가
  2. 검증 실패 시 Snackbar로 명확한 안내 메시지 표시
  3. 필수 필드에 대한 시각적 표시 추가 (빨간 별표 등)
  4. 테스트: 필수값 없이 저장 시도 시 안내 메시지 확인

### 6.2 테마 삭제 실패 (외래키 제약)
- **문제**: 테마 삭제 실패(Failed to delete theme: error: update or delete on table "themes" violates foreign key constraint "news_data_theme_cluster_id_themes_id_fk" on table "news_data")
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/theme-cluster-management.tsx`
  - `server/routes.ts` (테마 삭제 API)
  - `shared/schema.ts` (데이터베이스 스키마)
- **예상 작업**:
  1. 삭제 전 관련 `news_data` 확인 로직 추가
  2. 관련 데이터 존재 시 사용자에게 안내 (CASCADE 삭제 옵션 제공 또는 삭제 불가 안내)
  3. CASCADE 삭제 옵션 구현 (선택적으로)
  4. 테스트: 관련 데이터가 있는 테마 삭제 시나리오 테스트

### 6.3 테마 생성 불가
- **문제**: 테마 생성 불가
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/theme-cluster-management.tsx`
  - `server/routes.ts` (테마 생성 API)
- **예상 작업**:
  1. API 엔드포인트 확인 및 테스트
  2. 입력 데이터 검증 로직 확인
  3. 에러 핸들링 개선 (상세 에러 로그)
  4. 테스트: 테마 생성 시나리오 테스트

### 6.4 테마 수정 불가
- **문제**: 테마 수정 불가
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/theme-cluster-management.tsx`
  - `server/routes.ts` (테마 수정 API)
- **예상 작업**:
  1. 수정 API 엔드포인트 확인 및 테스트
  2. 데이터 전송 로직 확인
  3. 에러 핸들링 개선
  4. 테스트: 테마 수정 시나리오 테스트

### 6.5 카드와 상세 내용 불일치
- **문제**: 테마 내용 확인시, 카드에 표시되는 값과, 테마 상세 내용값이 다름
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/theme-cluster-management.tsx`
- **예상 작업**:
  1. 데이터 소스 확인 (카드 vs 상세 - 서로 다른 API 호출인지 확인)
  2. 데이터 동기화 로직 점검
  3. React Query 캐시 무효화 확인
  4. 테스트: 카드와 상세 내용 일치 여부 확인

---

## 7. 프롬프트 관리

**URL**: https://app-was-int-dev.azurewebsites.net/prompt-management  
**테스트 화면명**: 프롬프트 관리

### 7.1 필수값 입력 안내 개선
- **문제**: 새 프롬프트 생성시, 필수값 입력 안내 다르게 필요 (현재 탭과 다른 탭의 필수값을 입력하지 않고 저장 버튼 누를 경우, 필수값을 입력해달라는 안내가 보이지 않음): snackbar 등의 표시가 더 좋을 듯
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/prompt-management.tsx`
- **예상 작업**:
  1. 모든 탭의 필수값 검증 로직 추가
  2. 검증 실패 시 Snackbar로 명확한 안내 메시지 표시
  3. 어떤 탭의 어떤 필드가 필수인지 명시
  4. 필수 필드에 대한 시각적 표시 추가
  5. 테스트: 다른 탭의 필수값 없이 저장 시도 시 안내 메시지 확인

---

## 8. API 호출관리

**URL**: https://app-was-int-dev.azurewebsites.net/api-management  
**테스트 화면명**: API 호출관리

### 8.1 API 테스트 호출 404 에러
- **문제**: /api/api-calls/enhanced? 호출시 404 not found : API call not found 에러 발생. testApiCall() 함수 호출시, 파라미터 값(API id)이 없음
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/api-management.tsx`
  - `server/routes.ts` (API 테스트 엔드포인트)
- **예상 작업**:
  1. `testApiCall()` 함수 호출 시 API ID 파라미터 전달 확인
  2. 함수 호출 전 파라미터 검증 추가
  3. API ID가 없을 때 사용자에게 안내 메시지 표시
  4. 테스트: API 테스트 버튼 클릭 시 API ID 전달 확인

### 8.2 LuxiaCloud APIs 로드 버튼 작동 안함
- **문제**: LuxiaCloud APIs 로드 버튼 작동 안함
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/api-management.tsx`
  - `server/routes.ts` (LuxiaCloud API 로드 엔드포인트)
- **예상 작업**:
  1. API 엔드포인트 확인 및 테스트
  2. 네트워크 요청 로직 점검
  3. 에러 핸들링 추가
  4. 로딩 상태 표시 개선
  5. 테스트: LuxiaCloud APIs 로드 버튼 동작 확인

### 8.3 OPENAI_API_KEY API 테스트 실패
- **문제**: API키가 활성인 항목은 API 테스트 버튼이 있는데, 그중 OPENAI_API_KEY 항목은 API test failed: API test failed: Connection error.(API 테스트 실패)
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/api-management.tsx`
  - `server/routes.ts` (API 테스트 엔드포인트)
  - `server/services/api-test.ts` (API 테스트 로직)
- **예상 작업**:
  1. OpenAI API 연결 로직 확인
  2. 환경 변수 설정 확인 (OPENAI_API_KEY)
  3. 네트워크 타임아웃 설정 확인
  4. 에러 핸들링 개선 (Connection error 상세 정보)
  5. 테스트: OpenAI API 테스트 시나리오 테스트

---

## 9. Python 스크립트 관리

**URL**: https://app-was-int-dev.azurewebsites.net/python-management  
**테스트 화면명**: Python 스크립트 관리

### 9.1 필수값 입력 안내 개선
- **문제**: 새 스크립트 생성시, 필수값 입력 안내 다르게 필요 (현재 탭과 다른 탭의 필수값을 입력하지 않고 저장 버튼 누를 경우, 필수값을 입력해달라는 안내가 snackbar로 보이지만, 맨앞에 위치하지 않아서 잘 안보임)
- **우선순위**: 낮음
- **영향 파일**: 
  - `client/src/pages/python-management.tsx`
  - `client/src/components/ui/toaster.tsx` (Snackbar z-index 설정)
- **예상 작업**:
  1. Snackbar z-index 조정 (더 높은 값으로 설정)
  2. Snackbar 위치 조정 (화면 상단 중앙 또는 오른쪽 상단)
  3. 배경색 추가하여 가독성 개선
  4. 테스트: 필수값 없이 저장 시도 시 Snackbar 표시 확인

---

## 10. 프롬프트 빌더

**URL**: https://app-was-int-dev.azurewebsites.net/prompt-builder  
**테스트 화면명**: 프롬프트 빌더

### 10.1 Databricks 스키마 선택 문제
- **문제**: Databricks 스키마 선택 부분에 모든 Databricks 스키마가 안뜸 (["default","information_schema"]만 불러오고 있음. Nh_ai 내부 스키마들 호출해야함)
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/prompt-builder.tsx`
  - `server/routes.ts` (Databricks 스키마 조회 API)
  - `server/services/databricks.ts` (Databricks 스키마 조회 로직)
- **예상 작업**:
  1. Databricks Unity Catalog API를 사용하여 전체 스키마 조회
  2. `nh_ai` 스키마 포함하여 모든 스키마 로드
  3. 스키마 필터링 로직 확인 (필요시 제거)
  4. 테스트: 전체 스키마 목록 표시 확인

### 10.2 예시 프롬프트 SQL 변환 결과 표시 문제
- **문제**: 예시 프롬프트 탭 > 전체 시장 현황 요약 카드 영역 클릭시 https://app-was-int-dev.azurewebsites.net/api/nl-to-sql/convert를 호출하지만 response로 받아오는 sql 구문이 이상함. 추가로 해당 값이 화면에 UI적으로 표시되는 부분이 없음
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/prompt-builder.tsx`
  - `server/routes.ts` (NL-to-SQL 변환 API)
- **예상 작업**:
  1. SQL 변환 결과 표시 UI 컴포넌트 추가
  2. SQL 변환 로직 확인 및 개선
  3. 응답 데이터 구조 확인 (`response.sql` 등)
  4. 에러 핸들링 개선
  5. 테스트: SQL 변환 결과 표시 확인

### 10.3 커스텀 프롬프트 SQL 변환 문제
- **문제**: 커스텀 프롬프트 탭에서 SQL 변환시, 값이 이상함. SQL 변환이 아니라, 번역 기능 느낌. 11/4 - 간헐적으로(자주) 요청 한도 초과로 500에러가 나고, 에러가 나지 않아도 변환값이 표시되지 않음
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/prompt-builder.tsx`
  - `server/routes.ts` (NL-to-SQL 변환 API)
  - `server/services/nl-to-sql.ts` (SQL 변환 로직)
- **예상 작업**:
  1. SQL 변환 프롬프트 엔지니어링 개선
  2. Rate Limit 체크 및 에러 핸들링 개선
  3. 변환 결과 표시 로직 추가
  4. 백오프(Exponential Backoff) 재시도 로직 구현
  5. 테스트: SQL 변환 정확도 및 Rate Limit 대응 확인

---

## 11. 금융 AI 어시스턴트

**URL**: https://app-was-int-dev.azurewebsites.net/financial-chatbot  
**테스트 화면명**: 금융 AI 어시스턴트

### 11.1 채팅 영역 스크롤 처리
- **문제**: 채팅 영역 스크롤 처리 안되어있음 (응답이 길어지면, 채팅 영역을 벗어나서 표시됨)
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/financial-chatbot.tsx`
- **예상 작업**:
  1. 채팅 영역에 `overflow-y: auto` CSS 속성 추가
  2. `max-height` 설정하여 채팅 영역 높이 제한
  3. 자동 스크롤 로직 추가 (새 메시지 추가 시)
  4. 테스트: 긴 응답 시 스크롤 동작 확인

### 11.2 메시지 중복 기록 및 응답 표시 문제
- **문제**: 질의 후, 메시지를 전송하면 질의가 두번 기록됨. 그리고 응답 채팅 표시가 부자연스러움(응답 전체가 한번에 보여짐)
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/financial-chatbot.tsx`
  - `server/routes.ts` (AI 채팅 API)
- **예상 작업**:
  1. 메시지 전송 중복 방지 로직 추가 (전송 중 상태 체크)
  2. 메시지 ID 기반 중복 체크
  3. 스트리밍 응답 처리 (타이핑 효과) 구현
  4. 응답 청크 단위로 표시
  5. 테스트: 메시지 중복 기록 및 스트리밍 응답 확인

### 11.3 대화 전송 시 간헐적 500 에러 (요청 한도 초과)
- **문제**: 11/4 - (간헐적으로) 대화를 입력하고 전송했을 때 500에러 발생. - api/ai-chat api 오류. 요청 한도 초과
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/financial-chatbot.tsx`
  - `server/routes.ts` (AI 채팅 API)
- **예상 작업**:
  1. Rate Limit 체크 로직 추가
  2. 에러 응답 처리 개선 (429 Too Many Requests 대응)
  3. 사용자에게 재시도 안내 메시지 표시
  4. 백오프(Exponential Backoff) 재시도 로직 구현
  5. 테스트: Rate Limit 상황 시나리오 테스트

---

## 12. 로그 분석

**URL**: https://app-was-int-dev.azurewebsites.net/logs  
**테스트 화면명**: 로그 분석

### 12.1 로깅 활성화 설정 실패 (외래키 참조 오류)
- **문제**: 로깅 활성화 클릭시 500에러로 설정 업데이트 실패가 뜸. "Failed to update logging setting". - logging_settings 테이블을 update할때 외래키 참조 오류가 남
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/logs.tsx`
  - `server/routes.ts` (로깅 설정 API)
  - `shared/schema.ts` (데이터베이스 스키마)
- **예상 작업**:
  1. 외래키 제약 조건 확인
  2. 관련 테이블 데이터 존재 여부 확인 후 업데이트
  3. 기본 레코드 생성 로직 추가 (필요시)
  4. 에러 핸들링 개선
  5. 테스트: 로깅 활성화 설정 시나리오 테스트

---

## 13. 감사로그관리

**URL**: https://app-was-int-dev.azurewebsites.net/audit-log-management  
**테스트 화면명**: 감사로그관리

### 13.1 필터 검색 적용 안됨
- **문제**: 필터 검색 적용 안됨 - 날짜 설정을 했을 때 503 오류가 나거나 적용이 안됨
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/audit-log-management.tsx`
  - `server/routes.ts` (감사로그 API)
- **예상 작업**:
  1. 필터 검색 API 확인 및 테스트
  2. 프론트엔드 필터 파라미터 전달 로직 확인
  3. 날짜 형식 변환 로직 확인
  4. 503 에러 원인 분석 (서버 부하 또는 타임아웃)
  5. 에러 핸들링 개선
  6. 테스트: 날짜 필터 검색 시나리오 테스트

---

## 14. OpenAI 프로바이더

**URL**: https://app-was-int-dev.azurewebsites.net/openai-provider  
**테스트 화면명**: OpenAI 프로바이더

### 14.1 Standard OpenAI 연결 테스트 실패
- **문제**: Standart OpenAI 연결테스트 실패 (500 Internal Server Error: Connection error)
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/openai-provider.tsx`
  - `server/routes.ts` (OpenAI 연결 테스트 API)
- **예상 작업**:
  1. OpenAI API 연결 로직 확인
  2. 환경 변수 설정 확인 (OPENAI_API_KEY)
  3. 네트워크 타임아웃 설정 확인
  4. 에러 핸들링 개선 (Connection error 상세 정보)
  5. 테스트: OpenAI 연결 테스트 시나리오 테스트

---

## 15. AI 시황 생성 테스트

**URL**: https://app-was-int-dev.azurewebsites.net/ai-market-analysis  
**테스트 화면명**: AI 시황 생성 테스트

### 15.1 뉴스 데이터 수집 실행 에러
- **문제**: 페이지 하단에 뉴스데이터 수집 실행 버튼 클릭시, 에러 발생. Response 값이 제대로 안오는 듯 함.(Syntax Error: Unexpected token '<', "<!DOCTYPE...)
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/ai-market-analysis.tsx`
  - `server/routes.ts` (뉴스 데이터 수집 API)
- **예상 작업**:
  1. API 응답 형식 확인 (JSON vs HTML)
  2. 에러 응답 처리 로직 추가 (HTML 에러 페이지 대응)
  3. 응답 Content-Type 확인
  4. 에러 핸들링 개선
  5. 테스트: 뉴스 데이터 수집 실행 시나리오 테스트

### 15.2 WebSocket 연결 실패
- **문제**: 페이지 접속 시, WebSocker connection to 'ws://localhost:5000/ws' failed 에러 발생
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/ai-market-analysis.tsx`
  - `client/src/hooks/useWebSocket.ts`
  - 환경 변수 설정
- **예상 작업**:
  1. WebSocket 서버 URL 환경 변수 확인
  2. 프로덕션 환경에 맞는 WebSocket URL 설정
  3. WebSocket 연결 실패 시 재연결 로직 추가
  4. 테스트: WebSocket 연결 확인

---

## 16. 전체 화면 공통 이슈

### 16.1 TextInput 영역 드래그/전체선택 불가
- **문제**: TextInput 영역 내에 작성한 텍스트 드래그 불가함. Ctrl+A로 전체 선택도 불가함
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/components/ui/input.tsx` (공통 Input 컴포넌트)
  - `client/src/components/ui/textarea.tsx` (공통 Textarea 컴포넌트)
- **예상 작업**:
  1. Input/Textarea 컴포넌트에 `user-select: text` CSS 속성 추가
  2. `onSelect` 이벤트 핸들러 확인 및 제거 (드래그 방지 로직이 있다면)
  3. `onKeyDown` 핸들러에서 Ctrl+A 단축키 처리 확인
  4. 테스트: 모든 TextInput 영역에서 Ctrl+A, 드래그 선택 동작 확인

### 16.2 사이드바 시스템 상태 표시 문제
- **문제**: 시스템 상태가 장시간 지나면 정상->오류로 풀림. 새로고침 시 다시 정상 표기
- **우선순위**: 낮음
- **영향 파일**: 
  - `client/src/components/layout/sidebar.tsx`
  - `server/routes.ts` (시스템 상태 API)
- **예상 작업**:
  1. 상태 폴링 로직 확인
  2. 상태 정의 Tooltip 추가로 오류에 대한 오해 최소화
  3. 상태 체크 로직 개선 (타임아웃 처리)
  4. 테스트: 장시간 상태 표시 확인

### 16.3 최상단 검색 필드 문제
- **문제 1**: 키워드 검색이 잘 안됨 > 예를 들어 '호출' 이란 단어를 검색하면 관련 검색어가 나와야하는데 'API 호출 관리' 등의 결과가 나오지 않음
- **문제 2**: 검색어 입력 후 검색 창을 닫고 다시 검색 창을 열면, 직전 검색어가 그대로 저장되어있음
- **문제 3**: 11/4 테스트 결과 - 엔터를 눌러도 반응이 없음
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/components/layout/topbar.tsx`
- **예상 작업**:
  1. 검색 알고리즘 개선 (부분 문자열 매칭, 대소문자 구분 없음)
  2. 검색어 초기화 로직 추가 (검색 창 닫을 때)
  3. 엔터 키 이벤트 핸들러 추가
  4. 검색 결과 표시 로직 개선
  5. 테스트: 검색 기능 시나리오 테스트

---

## 17. 개인화 대시보드

**URL**: https://app-was-int-dev.azurewebsites.net/personal-dashboard  
**테스트 화면명**: 개인화 대시보드

### 17.1 프로필 조회 404 에러
- **문제**: /api/personalization/1/profile를 호출하는데, const user = await storage.getUser(userId); 에서 user가 존재하지 않아서 404에러가 뜸
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/personal-dashboard.tsx`
  - `server/routes.ts` (개인화 API)
  - `server/storage.ts` (사용자 조회 로직)
- **예상 작업**:
  1. 사용자 ID 확인 및 사용자 생성 로직 확인
  2. 기본 사용자 데이터 생성 또는 에러 핸들링 개선
  3. 사용자 존재 여부 체크 후 처리
  4. 테스트: 사용자 프로필 조회 시나리오 테스트

### 17.2 빈 화면 및 TypeError
- **문제**: 접속하면 빈 화면이 뜸 - item.addedAt?.toISOString()에서 TypeError. Watchlist의 addedat은 "2025-11-03T11:18:46.839Z"와 같이 String 형태로 반환되기 때문에 toISOString()을 호출했을 때 오류
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/personal-dashboard.tsx`
- **예상 작업**:
  1. 데이터 타입 확인 로직 추가
  2. String인 경우 Date 객체로 변환 후 toISOString() 호출
  3. 에러 핸들링 개선 (try-catch 블록 추가)
  4. 테스트: Watchlist 데이터 표시 확인

---

## 18. 매매 이력 분석

**URL**: https://app-was-int-dev.azurewebsites.net/my-trades  
**테스트 화면명**: 매매 이력 분석

### 18.1 내보내기 기능 반응 없음
- **문제**: "내보내기"를 클릭했을 때 반응이 없음. 이력이 없기 때문일수도 있음. 코드에서 이력이 없을 때 아무것도 안 하도록 되어있음. -> "보유 종목 관리" 화면에서는 이력이 없을 때 내보내기를 클릭하면 "내보낼 데이터가 없습니다"가 뜸
- **우선순위**: 낮음
- **영향 파일**: 
  - `client/src/pages/my-trades.tsx`
- **예상 작업**:
  1. 이력이 없을 때 "내보낼 데이터가 없습니다" 메시지 표시 (보유 종목 관리 화면처럼)
  2. 사용자 안내 메시지 개선
  3. 테스트: 이력이 없을 때 내보내기 버튼 클릭 시나리오 테스트

---

## 19. 관심 종목 관리

**URL**: https://app-was-int-dev.azurewebsites.net/my-watchlist  
**테스트 화면명**: 관심 종목 관리

### 19.1 주식 검색 TypeError
- **문제**: 주식 검색을 하면 watchlist-manager.tsx의 value.toFixed(2)에서 value가 undefinded라서 TypeError 생김
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/my-watchlist.tsx` 또는 `client/src/components/watchlist-manager.tsx`
- **예상 작업**:
  1. value가 undefined인 경우 처리 로직 추가
  2. 기본값 설정 또는 조건부 처리 (`value?.toFixed(2) || '0.00'`)
  3. 데이터 검증 로직 추가
  4. 테스트: 주식 검색 시나리오 테스트

### 19.2 웹소켓 연결 끊김 표시
- **문제**: 1번 오류 이후 관심 종목 관리 페이지를 누르면 웹소켓 연결이 끊어진 것으로 나옴
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/my-watchlist.tsx`
  - `client/src/hooks/useWebSocket.ts`
- **예상 작업**:
  1. 에러 발생 후 웹소켓 재연결 로직 추가
  2. 에러 복구 메커니즘 구현
  3. 웹소켓 연결 상태 체크 로직 개선
  4. 테스트: 웹소켓 연결 끊김 시나리오 테스트

---

## 20. 개인화 설정

**URL**: https://app-was-int-dev.azurewebsites.net/personalization-settings  
**테스트 화면명**: 개인화 설정

### 20.1 프로필 저장 실패
- **문제**: 정보를 입력한 뒤 "프로필 저장"을 눌렀을 때, "프로필 저장 실패"가 뜸. Failed to update profile settings
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/personalization-settings.tsx`
  - `server/routes.ts` (개인화 설정 API)
- **예상 작업**:
  1. API 에러 로그 확인
  2. 데이터베이스 제약 조건 확인
  3. 입력 데이터 검증 로직 확인
  4. 에러 핸들링 개선
  5. 테스트: 프로필 저장 시나리오 테스트

### 20.2 사용자 조회 실패
- **문제**: /api/personalization/:userId/settings api를 호출했을 때, const user = await storage.getUser(userId)가 실행되는데, user이 존재하지 않음
- **우선순위**: 높음
- **영향 파일**: 
  - `server/routes.ts` (개인화 설정 API)
  - `server/storage.ts` (사용자 조회 로직)
- **예상 작업**:
  1. 사용자 생성 로직 확인
  2. 기본 사용자 데이터 생성 또는 에러 핸들링
  3. 사용자 존재 여부 체크 후 처리
  4. 테스트: 사용자 설정 조회 시나리오 테스트

---

## 21. ETF 투자가이드 상담

**URL**: https://app-was-int-dev.azurewebsites.net/etf-guide  
**테스트 화면명**: ETF 투자가이드 상담

### 21.1 세션 시작 실패
- **문제**: 처음 페이지에 접속했을 때 "세션 시작 실패"가 뜸. - api/etf-bot/recommendations?userId=1로 api를 호출했을 때 recommends.ts에서 const userProfile = storage.getUserRiskProfile(userId)가 실행되는데, userProfile이 존재하지 않음
- **우선순위**: 높음
- **영향 파일**: 
  - `client/src/pages/etf-guide.tsx`
  - `server/routes.ts` (ETF 봇 API)
  - `server/services/etf-bot.ts` 또는 `server/services/recommends.ts`
- **예상 작업**:
  1. 사용자 프로필 생성 로직 확인
  2. 기본 위험 프로필 데이터 생성 또는 에러 핸들링
  3. 사용자 프로필 존재 여부 체크 후 처리
  4. 테스트: ETF 봇 세션 시작 시나리오 테스트

---

## 22. 워크플로우 모니터링

**URL**: https://app-was-int-dev.azurewebsites.net/workflow-monitor  
**테스트 화면명**: 워크플로우 모니터링

### 22.1 데이터소스 노드 실행 시 SQL 쿼리 ID 미설정 에러
- **문제**: 데이터소스 노드를 드래그 하여 워크플로우 실행시 > 오류: SQL 쿼리 ID가 설정되지 않았습니다. 데이터소스 노드를 더블클릭하여 워크플로우 실행시 > 정상: 쿼리 ID생성
- **우선순위**: 중간
- **영향 파일**: 
  - `client/src/pages/workflow-monitor.tsx`
  - `client/src/components/workflow/workflow-node.tsx`
  - `server/services/workflow-execution.ts`
- **예상 작업**:
  1. 데이터소스 노드 설정에서 SQL 쿼리 ID 자동 생성 로직 추가
  2. 드래그 실행 시에도 쿼리 ID 생성 보장
  3. 노드 설정 검증 로직 추가
  4. 테스트: 데이터소스 노드 실행 시나리오 테스트

---

## 우선순위별 작업 계획

### 우선순위 높음 (즉시 처리 필요)

1. **홈 화면** - 대화 전송 시 간헐적 500 에러 (요청 한도 초과)
2. **워크플로우 편집기** - API 호출 노드 삭제 시 에러
3. **워크플로우 편집기** - 종료노드 Databricks gold 스키마 저장 기능
4. **워크플로우 편집기** - AI 분석 노드 실행 오류
5. **실행 스케줄러** - 상태 업데이트 타이밍 불일치
6. **실행 스케줄러** - 스케줄러 중지 후 시작 버튼 500 에러
7. **Dictionary 관리** - 새 항목 추가 실패 (외래키 제약 위반)
8. **테마 클러스터 관리** - 테마 삭제/생성/수정 문제
9. **API 호출관리** - API 테스트 호출 404 에러, OPENAI_API_KEY API 테스트 실패
10. **프롬프트 빌더** - Databricks 스키마 선택 문제, SQL 변환 문제
11. **금융 AI 어시스턴트** - 대화 전송 시 간헐적 500 에러 (요청 한도 초과)
12. **로그 분석** - 로깅 활성화 설정 실패 (외래키 참조 오류)
13. **OpenAI 프로바이더** - Standard OpenAI 연결 테스트 실패
14. **AI 시황 생성 테스트** - 뉴스 데이터 수집 실행 에러
15. **개인화 대시보드** - 프로필 조회 404 에러, 빈 화면 TypeError
16. **관심 종목 관리** - 주식 검색 TypeError
17. **개인화 설정** - 프로필 저장 실패, 사용자 조회 실패
18. **ETF 투자가이드 상담** - 세션 시작 실패

### 우선순위 중간 (단기 처리 필요)

1. **홈 화면** - AI 어시스턴트 대화 입력 전체 선택 및 드래그 불가
2. **Azure 서비스 설정** - 커스텀 서비스 추가 후 UI 미표시
3. **워크플로우 편집기** - AI 분석 노드 프롬프트 저장 후 표시 문제
4. **테마 클러스터 관리** - 필수 요소 검증 안내 부재, 카드와 상세 내용 불일치
5. **프롬프트 관리** - 필수값 입력 안내 개선
6. **API 호출관리** - LuxiaCloud APIs 로드 버튼 작동 안함
7. **금융 AI 어시스턴트** - 채팅 영역 스크롤 처리, 메시지 중복 기록 및 응답 표시 문제
8. **감사로그관리** - 필터 검색 적용 안됨
9. **AI 시황 생성 테스트** - WebSocket 연결 실패
10. **전체 화면 공통** - TextInput 드래그/선택 문제, 최상단 검색 필드 문제
11. **관심 종목 관리** - 웹소켓 연결 끊김 표시
12. **워크플로우 모니터링** - 데이터소스 노드 실행 시 SQL 쿼리 ID 미설정 에러

### 우선순위 낮음 (장기 개선)

1. **홈 화면** - 대화내역 드래그 불가, 스마트 제안 아이콘 상태 확인 불가
2. **Python 스크립트 관리** - 필수값 입력 안내 개선
3. **사이드바** - 시스템 상태 표시 문제
4. **매매 이력 분석** - 내보내기 기능 반응 없음

---

## 작업 진행 방식 제안

### 1단계: 데이터베이스 관련 이슈 해결
- 외래키 제약 조건 확인 및 수정
- 사용자/프로필 데이터 생성 로직 점검
- 관련: Dictionary 관리, 테마 클러스터 관리, 로그 분석, 개인화 관련 화면들

### 2단계: API 엔드포인트 및 에러 핸들링 개선
- 404, 500 에러 발생 원인 분석 및 수정
- 파라미터 검증 로직 추가
- Rate Limit 대응 로직 추가
- 관련: API 호출관리, 워크플로우 편집기, OpenAI 프로바이더, AI 시황 생성 테스트, 금융 AI 어시스턴트

### 3단계: UI/UX 개선
- 필수값 검증 및 사용자 안내 강화
- 스크롤, 드래그, 선택 기능 개선
- 관련: 전체 화면 공통 이슈, 프롬프트 관리, Python 스크립트 관리, 테마 클러스터 관리

### 4단계: 비즈니스 로직 개선
- SQL 변환 로직 개선
- 상태 관리 및 동기화 로직 개선
- 워크플로우 실행 로직 개선
- 관련: 프롬프트 빌더, 실행 스케줄러, 금융 AI 어시스턴트, 워크플로우 편집기

---

## 예상 작업 시간

- **우선순위 높음**: 약 50-60시간
- **우선순위 중간**: 약 35-45시간
- **우선순위 낮음**: 약 10-15시간
- **총 예상 시간**: 약 95-120시간

---

## 참고사항

1. 모든 작업은 테스트 환경에서 먼저 검증 후 프로덕션 배포
2. 데이터베이스 스키마 변경 시 마이그레이션 스크립트 작성 필요
3. API 변경 시 프론트엔드와 백엔드 동시 수정 필요
4. 외래키 제약 조건 변경 시 신중한 검토 필요
5. Rate Limit 관련 이슈는 API 제공 업체의 정책 확인 필요
6. WebSocket 연결은 프로덕션 환경 URL 설정 확인 필요

