# 로그 분석 기반 추가 수정 작업 계획서

**작성일**: 2025-01-28  
**분석 대상**: `logs/error-*.log` 파일들

---

## 1. Dictionary Manager - Select.Item 빈 값 에러

### 문제
- **에러 메시지**: `A <Select.Item /> must have a value prop that is not an empty string`
- **발생 위치**: `/dictionary-manager` 페이지
- **발생 빈도**: 매우 높음 (로그에서 반복적으로 발생)
- **에러 원인**: SelectItem에 빈 문자열(`""`) 값이 전달됨

### 분석
- 현재 코드에서 `dialogColumns.filter(column => column.name && column.name.trim() !== "")` 로 필터링하고 있으나, 여전히 빈 값이 전달되는 경우가 있음
- `table.name`이나 `column.name`이 빈 문자열이거나 undefined일 수 있음
- SelectItem의 `value` prop에 빈 문자열이 들어가면 Radix UI Select에서 에러 발생

### 수정 작업
1. `dictionary-manager.tsx`에서 SelectItem 생성 시 빈 값 검증 강화
2. 테이블/컬럼 목록 필터링 로직 개선
3. 기본값 처리 및 안전 가드 추가

### 영향 파일
- `client/src/pages/dictionary-manager.tsx`

### 우선순위
**높음** (사용자 경험에 직접적인 영향)

---

## 2. Live Status Banner - undefined 서비스 상태 에러

### 문제
- **에러 메시지**: `undefined is not an object (evaluating 'services.openaiPTU.status')`
- **발생 위치**: `/dashboard` 페이지, `live-status-banner.tsx`
- **발생 빈도**: 중간
- **에러 원인**: `services.openaiPTU`가 undefined일 때 `.status` 접근 시도

### 분석
- 현재 코드에서 `services.openai?.status || services.openaiPTU?.status` 형태로 optional chaining을 사용하고 있으나, 일부 위치에서 여전히 직접 접근하고 있음
- `services.openaiPTU`가 API 응답에 포함되지 않을 수 있음

### 수정 작업
1. 모든 `services.openaiPTU` 접근에 optional chaining 적용
2. 기본값 처리 개선
3. 서비스 상태 조회 시 안전한 접근 보장

### 영향 파일
- `client/src/components/common/live-status-banner.tsx`

### 우선순위
**중간** (대시보드 접근 시 에러 발생 가능)

---

## 3. 워크플로우 편집기 - 노드 Position undefined 에러

### 문제
- **에러 메시지**: `Cannot read properties of undefined (reading 'x')`
- **발생 위치**: `/workflow-editor` 페이지
- **발생 빈도**: 중간
- **에러 원인**: ReactFlow 노드의 `position` 속성이 undefined

### 분석
- 노드 생성 시 `position`이 항상 설정되어야 하나, 일부 경우에 undefined일 수 있음
- 워크플로우 로드 시 저장된 노드 데이터에 position이 없을 수 있음
- 기존 노드 데이터 변환 시 position 누락 가능

### 수정 작업
1. 노드 생성 시 기본 position 값 보장
2. 워크플로우 로드 시 노드 데이터에 position이 없으면 기본값 설정
3. 노드 데이터 변환 로직에서 position 검증 추가

### 영향 파일
- `client/src/pages/workflow-editor.tsx`
- `client/src/components/workflow/workflow-canvas.tsx`

### 우선순위
**중간** (워크플로우 편집 시 에러 발생 가능)

---

## 4. Azure CosmosDB Gremlin 모듈 Import 에러

### 문제
- **에러 메시지**: `The requested module 'gremlin' does not provide an export named 'Client'` / `driver`
- **발생 위치**: `/api/azure/test/cosmosdb` API 엔드포인트
- **발생 빈도**: 낮음 (테스트 시에만 발생)
- **에러 원인**: Gremlin 모듈 import 방식 오류

### 분석
- 현재 `azure-cosmosdb-gremlin.ts` 파일이 전체 주석 처리되어 있음
- 실제로 사용되지 않는 것으로 보이나, API 엔드포인트에서 참조 시도 시 에러 발생
- Gremlin 모듈의 올바른 import 방식 확인 필요

### 수정 작업
1. `azure-cosmosdb-gremlin.ts` 파일의 import 문 수정
2. 사용하지 않는 경우 API 엔드포인트에서 참조 제거
3. Gremlin 모듈 사용 여부 확인 및 필요 시 올바른 패키지 설치

### 영향 파일
- `server/services/azure-cosmosdb-gremlin.ts`
- `server/routes.ts` (CosmosDB 테스트 엔드포인트)

### 우선순위
**낮음** (특정 테스트 시나리오에서만 발생)

---

## 5. Azure Databricks 연결 403 에러

### 문제
- **에러 메시지**: `Received a response with a bad HTTP status code: 403`
- **발생 위치**: `/api/azure/test/databricks` API 엔드포인트
- **발생 빈도**: 낮음
- **에러 원인**: Databricks API 접근 권한 문제

### 분석
- 403 Forbidden 에러는 인증/권한 문제
- Databricks 토큰 또는 권한 설정 확인 필요
- 에러 메시지 개선 필요 (사용자에게 명확한 안내)

### 수정 작업
1. Databricks 연결 테스트 시 더 명확한 에러 메시지 제공
2. 403 에러 발생 시 권한 문제임을 명확히 안내
3. 에러 로깅 개선

### 영향 파일
- `server/services/azure-databricks.ts`
- `server/routes.ts` (Databricks 테스트 엔드포인트)

### 우선순위
**낮음** (설정 문제일 가능성이 높음)

---

## 작업 우선순위 요약

| 작업 | 우선순위 | 예상 소요 시간 | 영향 범위 |
|------|---------|--------------|----------|
| Dictionary Manager - Select.Item 빈 값 | 높음 | 1시간 | 사용자 경험 |
| Live Status Banner - undefined 서비스 | 중간 | 1시간 | 대시보드 |
| 워크플로우 편집기 - Position undefined | 중간 | 1.5시간 | 워크플로우 편집 |
| Azure CosmosDB Gremlin Import | 낮음 | 2시간 | 특정 테스트 |
| Azure Databricks 403 에러 | 낮음 | 0.5시간 | 에러 메시지 개선 |

---

---

## 6. PostgreSQL SSL 연결 에러

### 문제
- **에러 메시지**: `The server does not support SSL connections`
- **발생 위치**: 워크플로우 세션 생성 (`createWorkflowSession`)
- **발생 빈도**: 중간
- **에러 원인**: PostgreSQL 연결 시 SSL 설정 문제

### 분석
- PostgreSQL 서버가 SSL을 지원하지 않거나, 클라이언트에서 SSL을 강제하는 경우 발생
- 연결 설정에서 SSL 모드가 잘못 설정되었을 수 있음
- 환경에 따라 SSL이 필요하지 않은 경우도 있음

### 수정 작업
1. PostgreSQL 연결 설정에서 SSL 모드 확인 및 수정
2. SSL 모드를 선택적으로 설정할 수 있도록 개선
3. 환경 변수로 SSL 모드 제어 가능하도록 수정
4. 에러 메시지 개선 (SSL 미지원 시 명확한 안내)

### 영향 파일
- `server/db.ts` (PostgreSQL 연결 설정)
- `server/storage.ts` (데이터베이스 연결)
- 환경 변수 설정 파일

### 우선순위
**높음** (워크플로우 실행에 직접적인 영향)

---

## 7. 워크플로우 노드 의존성 외래키 제약 위반

### 문제
- **에러 메시지**: `insert or update on table "workflow_node_dependencies" violates foreign key constraint "workflow_node_dependencies_from_node_id_workflow_nodes_id_fk"`
- **발생 위치**: `/api/workflow/ai-market-analysis/execute` API 엔드포인트
- **발생 빈도**: 높음 (로그에서 반복적으로 발생)
- **에러 원인**: 워크플로우 노드 의존성 생성 시 존재하지 않는 노드 ID 참조

### 분석
- `workflow_node_dependencies` 테이블에 노드 의존성을 삽입할 때, 참조하는 `from_node_id`가 `workflow_nodes` 테이블에 존재하지 않음
- 워크플로우 실행 시 노드 생성 순서 문제
- 노드 ID와 의존성 관계 불일치

### 수정 작업
1. 워크플로우 노드 의존성 생성 전 노드 존재 여부 확인
2. 노드 생성 순서 보장 로직 추가
3. 의존성 관계 검증 로직 강화
4. 에러 핸들링 개선 (존재하지 않는 노드 ID 명시)

### 영향 파일
- `server/storage.ts` (워크플로우 노드 의존성 생성 로직)
- `server/services/workflow-execution-engine.ts`
- `server/routes.ts` (워크플로우 실행 API)

### 우선순위
**높음** (워크플로우 실행 실패 원인)

---

## 8. 워크플로우 템플릿 생성 외래키 제약 위반

### 문제
- **에러 메시지**: `insert or update on table "workflow_templates" violates foreign key constraint "workflow_templates_created_by_users_id_fk"`
- **발생 위치**: `/api/workflow/templates/create` API 엔드포인트
- **발생 빈도**: 중간
- **에러 원인**: 워크플로우 템플릿 생성 시 존재하지 않는 사용자 ID 참조

### 분석
- `workflow_templates` 테이블의 `created_by` 필드가 `users` 테이블에 존재하지 않는 사용자 ID를 참조
- 인증되지 않은 사용자 또는 존재하지 않는 사용자로 템플릿 생성 시도
- 사용자 ID 검증 로직 부재

### 수정 작업
1. 워크플로우 템플릿 생성 전 사용자 존재 여부 확인
2. 인증된 사용자 ID 검증 로직 추가
3. 기본 사용자 ID 또는 null 처리 옵션 추가
4. 에러 메시지 개선 (존재하지 않는 사용자 ID 명시)

### 영향 파일
- `server/storage.ts` (워크플로우 템플릿 생성 로직)
- `server/routes.ts` (워크플로우 템플릿 생성 API)

### 우선순위
**중간** (템플릿 생성 기능에 영향)

---

## 9. Azure Config 서비스 함수 누락

### 문제
- **에러 메시지**: 
  - `azureConfigService.getConfig is not a function`
  - `azureConfigService.getOpenAIConfig is not a function`
  - `azureConfigService.getAzureSearchConfig is not a function`
- **발생 위치**: Azure 서비스 초기화 시
- **발생 빈도**: 중간
- **에러 원인**: `azureConfigService` 객체에 해당 메서드가 없거나 export되지 않음

### 분석
- `azure-config.ts` 서비스에서 메서드가 정의되지 않았거나 export되지 않음
- 메서드 이름 변경 또는 제거되었을 가능성
- import 경로 또는 방식 오류

### 수정 작업
1. `azure-config.ts` 파일에서 메서드 정의 확인
2. 메서드 export 확인 및 수정
3. 호출하는 위치에서 올바른 메서드 사용 확인
4. 메서드 이름 통일 및 일관성 확보

### 영향 파일
- `server/services/azure-config.ts`
- `server/routes.ts` (Azure 서비스 초기화 부분)
- `server/services/azure-*.ts` (Azure 서비스 파일들)

### 우선순위
**중간** (Azure 서비스 초기화에 영향)

---

## 10. PostgreSQL 연결 타임아웃

### 문제
- **에러 메시지**: `connect ETIMEDOUT 64:ff9b::14c4:639f:5432`
- **발생 위치**: 다양한 API 엔드포인트 (Dictionary Manager, 프롬프트 카탈로그, 워크플로우 조회 등)
- **발생 빈도**: 높음
- **에러 원인**: PostgreSQL 서버 연결 타임아웃

### 분석
- IPv6 주소로 연결 시도 시 타임아웃 발생
- 네트워크 연결 문제 또는 서버 응답 지연
- 연결 풀 설정 문제 가능성
- 타임아웃 설정이 너무 짧을 수 있음

### 수정 작업
1. PostgreSQL 연결 타임아웃 설정 확인 및 증가
2. IPv6 주소 대신 IPv4 주소 사용 옵션 추가
3. 연결 재시도 로직 추가
4. 연결 풀 설정 최적화
5. 에러 메시지 개선 (네트워크 문제 명시)

### 영향 파일
- `server/db.ts` (PostgreSQL 연결 설정)
- `server/storage.ts` (데이터베이스 연결)
- 환경 변수 설정 파일

### 우선순위
**높음** (데이터베이스 연결 실패 시 전체 시스템 영향)

---

## 총 예상 작업 시간
약 10시간 (기존 6시간 + 추가 4시간)

---

## 작업 우선순위 요약 (업데이트)

| 작업 | 우선순위 | 예상 소요 시간 | 영향 범위 |
|------|---------|--------------|----------|
| Dictionary Manager - Select.Item 빈 값 | 높음 | 1시간 | 사용자 경험 |
| PostgreSQL SSL 연결 에러 | 높음 | 1시간 | 워크플로우 실행 |
| 워크플로우 노드 의존성 외래키 | 높음 | 2시간 | 워크플로우 실행 |
| PostgreSQL 연결 타임아웃 | 높음 | 1.5시간 | 전체 시스템 |
| Live Status Banner - undefined 서비스 | 중간 | 1시간 | 대시보드 |
| 워크플로우 편집기 - Position undefined | 중간 | 1.5시간 | 워크플로우 편집 |
| 워크플로우 템플릿 외래키 | 중간 | 1시간 | 템플릿 생성 |
| Azure Config 서비스 함수 누락 | 중간 | 1.5시간 | Azure 서비스 |
| Azure CosmosDB Gremlin Import | 낮음 | 2시간 | 특정 테스트 |
| Azure Databricks 403 에러 | 낮음 | 0.5시간 | 에러 메시지 개선 |

---

## 참고사항
- 일부 에러는 이미 수정되었을 수 있으므로, 실제 코드 확인 후 진행
- 로그 분석 결과를 바탕으로 우선순위가 높은 작업부터 진행 권장
- 각 작업 완료 후 해당 에러가 재발하지 않는지 확인 필요
- PostgreSQL 연결 관련 에러는 네트워크 환경에 따라 달라질 수 있으므로, 다양한 환경에서 테스트 필요

